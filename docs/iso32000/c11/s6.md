# 11.6 指定 PDF 中的透明度

**Specifying Transparency in PDF**

## 11.6.1 概述

**General**

=== "中文"

    The preceding sub-clauses have presented the transparent imaging model at an abstract level, with little mention of its representation in PDF. This sub-clause describes the facilities available for specifying transparency in PDF.

=== "英文"

    The preceding sub-clauses have presented the transparent imaging model at an abstract level, with little mention of its representation in PDF. This sub-clause describes the facilities available for specifying transparency in PDF.

## 11.6.2 指定源颜色和背景颜色

**Specifying Source and Backdrop Colours**

=== "中文"

    Single graphics objects, as defined in “[Graphics Objects](../c8/s2.md)”, shall be treated as elementary objects for transparency compositing purposes (subject to special treatment for text objects, as described in “[Text Knockout](../c9/s3.md#938-文本镂空切割)”). That is, all of a given object shall be considered to be one element of a transparency stack. Portions of an object shall not be composited with one another, even if they are described in a way that would seem to cause overlaps (such as a self-intersecting path, combined fill and stroke of a path, or a shading pattern containing an overlap or fold-over). An object’s source colour $C_s$ , used in the colour compositing formula, shall be specified in the same way as in the opaque imaging model: by means of the current colour in the graphics state or the source samples in an image. The backdrop colour $C_b$ shall be the result of previous painting operations.

=== "英文"

    Single graphics objects, as defined in “[Graphics Objects](../c8/s2.md)”, shall be treated as elementary objects for transparency compositing purposes (subject to special treatment for text objects, as described in “[Text Knockout](../c9/s3.md#938-文本镂空切割)”). That is, all of a given object shall be considered to be one element of a transparency stack. Portions of an object shall not be composited with one another, even if they are described in a way that would seem to cause overlaps (such as a self-intersecting path, combined fill and stroke of a path, or a shading pattern containing an overlap or fold-over). An object’s source colour $C_s$ , used in the colour compositing formula, shall be specified in the same way as in the opaque imaging model: by means of the current colour in the graphics state or the source samples in an image. The backdrop colour $C_b$ shall be the result of previous painting operations.

## 11.6.3 指定混合色彩空间和混合模式

**Specifying Blending Colour Space and Blend Mode**

=== "中文"

    The blending colour space shall be an attribute of the transparency group within which an object is painted; its specification is described in [11.6.6], "Transparency Group XObjects." The page as a whole shall also be treated as a group, the *page group* (see “[Page Group](./s4.md#1147-page组)”), with a colour space attribute of its own. If not otherwise specified, the page group’s colour space shall be inherited from the native colour space of the output device.
    
    The blend mode $B (C_b , C_s )$ shall be determined by the *current blend mode* parameter in the graphics state (see “[Graphics State](../c8/s4.md#841-概述)”), which is specified by the **BM** entry in a graphics state parameter dictionary ( “[Graphics State Parameter Dictionaries](../c8/s4.md#845-图形状态参数字典)”). Its value shall be either a name object, designating one of the standard blend modes listed in Tables [136](./s3.md#table136) and [137](./s3.md#table137) in [11.3.5], "Blend Mode," or an array of such names. In the latter case, the application shall use the first blend mode in the array that it recognizes (or **Normal** if it recognizes none of them).
    
    !!! note "NOTE"
    
        New blend modes may be introduced in the future, and conforming readers that do not recognize them should have reasonable fallback behavior.
    
    The current blend mode shall always apply to process colour components; but only sometimes may apply to spot colorants, see [11.7.4.2], "Blend Modes and Overprinting," for details.

=== "英文"

    The blending colour space shall be an attribute of the transparency group within which an object is painted; its specification is described in [11.6.6], "Transparency Group XObjects." The page as a whole shall also be treated as a group, the *page group* (see “[Page Group](./s4.md#1147-page组)”), with a colour space attribute of its own. If not otherwise specified, the page group’s colour space shall be inherited from the native colour space of the output device.
    
    The blend mode $B (C_b , C_s )$ shall be determined by the *current blend mode* parameter in the graphics state (see “[Graphics State](../c8/s4.md#841-概述)”), which is specified by the **BM** entry in a graphics state parameter dictionary ( “[Graphics State Parameter Dictionaries](../c8/s4.md#845-图形状态参数字典)”). Its value shall be either a name object, designating one of the standard blend modes listed in Tables [136](./s3.md#table136) and [137](./s3.md#table137) in [11.3.5], "Blend Mode," or an array of such names. In the latter case, the application shall use the first blend mode in the array that it recognizes (or **Normal** if it recognizes none of them).
    
    !!! note "NOTE"
    
        New blend modes may be introduced in the future, and conforming readers that do not recognize them should have reasonable fallback behavior.
    
    The current blend mode shall always apply to process colour components; but only sometimes may apply to spot colorants, see [11.7.4.2], "Blend Modes and Overprinting," for details.


## 11.6.4 指定形状和不透明度

**Specifying Shape and Opacity**

### 11.6.4.1 概述

**General**

=== "中文"

    As discussed under [11.3.7.2], "Source Shape and Opacity," the shape *(f)* and opacity *(q)* values used in the compositing computation shall come from one or more of the following sources:
    
    - The intrinsic shape $(f_j )$ and opacity $(q_j )$ of the object being composited
    - A separate shape $(f_m )$ or opacity $(q_m )$ mask independent of the object itself
    - A scalar shape $(f_k )$ or opacity $(q_k )$ constant to be added at every point
    
    The following sub-clauses describe how each of these shape and opacity sources shall be specified in PDF.

=== "英文"

    As discussed under [11.3.7.2], "Source Shape and Opacity," the shape *(f)* and opacity *(q)* values used in the compositing computation shall come from one or more of the following sources:
    
    - The intrinsic shape $(f_j )$ and opacity $(q_j )$ of the object being composited
    - A separate shape $(f_m )$ or opacity $(q_m )$ mask independent of the object itself
    - A scalar shape $(f_k )$ or opacity $(q_k )$ constant to be added at every point
    
    The following sub-clauses describe how each of these shape and opacity sources shall be specified in PDF.

### 11.6.4.2 物体形状和不透明度

**Object Shape and Opacity**

=== "中文"

    The shape value $f_j$ of an object painted with PDF painting operators shall be defined as follows:
    
    - For objects defined by a path or a glyph and painted in a uniform colour with a path-painting or text-showing operator (“[Path-Painting Operators](../c8/s5.md#853-路径绘制运算符)”, and “[Text-Showing Operators](../c9/s4.md#943-文本显示操作符)”), the shape shall always be 1.0 inside and 0.0 outside the path.
    - For images (“[Images](../c8/s9.md)”), the shape shall be 1.0 inside the image rectangle and 0.0 outside it. This may be further modified by an explicit or colour key mask (“[Explicit Masking](../c8/s9.md#8963-显式掩蔽)” and “[Colour Key Masking](../c8/s9.md#8964-色彩键遮罩)”).
    - For image masks (“[Stencil Masking](../c8/s9.md#8962-模板蒙板)”), the shape shall be 1.0 for painted areas and 0.0 for masked areas.
    - For objects painted with a tiling pattern (“[Tiling Patterns](../c8/s7.md#873-平铺图案)”) or a shading pattern (“[Shading Patterns](../c8/s7.md#874-底纹图案)”), the shape shall be further constrained by the objects that define the pattern (see “[Patterns and Transparency](#1167-图案和透明度)”).
    - For objects painted with the **sh** operator (“[Shading Operator](../c8/s7.md#8742-底纹操作)”), the shape shall be 1.0 inside and 0.0 outside the bounds of the shading’s painting geometry, disregarding the **Background** entry in the shading dictionary (see “[Shading Dictionaries](../c8/s7.md#8743-底纹字典)”).
    
    All elementary objects shall have an intrinsic opacity $q_j$ of 1.0 everywhere. Any desired opacity less than 1.0 shall be applied by means of an opacity mask or constant, as described in the following sub-clauses.

=== "英文"

    The shape value $f_j$ of an object painted with PDF painting operators shall be defined as follows:
    
    - For objects defined by a path or a glyph and painted in a uniform colour with a path-painting or text-showing operator (“[Path-Painting Operators](../c8/s5.md#853-路径绘制运算符)”, and “[Text-Showing Operators](../c9/s4.md#943-文本显示操作符)”), the shape shall always be 1.0 inside and 0.0 outside the path.
    - For images (“[Images](../c8/s9.md)”), the shape shall be 1.0 inside the image rectangle and 0.0 outside it. This may be further modified by an explicit or colour key mask (“[Explicit Masking](../c8/s9.md#8963-显式掩蔽)” and “[Colour Key Masking](../c8/s9.md#8964-色彩键遮罩)”).
    - For image masks (“[Stencil Masking](../c8/s9.md#8962-模板蒙板)”), the shape shall be 1.0 for painted areas and 0.0 for masked areas.
    - For objects painted with a tiling pattern (“[Tiling Patterns](../c8/s7.md#873-平铺图案)”) or a shading pattern (“[Shading Patterns](../c8/s7.md#874-底纹图案)”), the shape shall be further constrained by the objects that define the pattern (see “[Patterns and Transparency](#1167-图案和透明度)”).
    - For objects painted with the **sh** operator (“[Shading Operator](../c8/s7.md#8742-底纹操作)”), the shape shall be 1.0 inside and 0.0 outside the bounds of the shading’s painting geometry, disregarding the **Background** entry in the shading dictionary (see “[Shading Dictionaries](../c8/s7.md#8743-底纹字典)”).
    
    All elementary objects shall have an intrinsic opacity $q_j$ of 1.0 everywhere. Any desired opacity less than 1.0 shall be applied by means of an opacity mask or constant, as described in the following sub-clauses.


### 11.6.4.3 蒙版形状和不透明度

**Mask Shape and Opacity**

=== "中文"

    At most one mask input—called a *soft mask*, or *alpha mask*—shall be provided to any PDF compositing operation. The mask may serve as a source of either shape ($f_m$ ) or opacity ($q_m$ ) values, depending on the setting of the *alpha source* parameter in the graphics state (see “[Graphics State](../c8/s4.md)”). This is a boolean flag, set with the **AIS** (“alpha is shape”) entry in a graphics state parameter dictionary (“[Graphics State Parameter Dictionaries](../c8/s5.md)”): **true** if the soft mask contains shape values, **false** for opacity.
    
    The soft mask shall be specified in one of the following ways:
    
    - The *current soft mask* parameter in the graphics state, set with the **SMask** entry in a graphics state parameter dictionary, contains a soft-mask dictionary (see “[Soft-Mask Dictionaries](#11652-软掩码词典)”) defining the contents of the mask. The name **None** may be specified in place of a soft-mask dictionary, denoting the absence of a soft mask. In this case, the mask shape or opacity shall be implicitly 1.0 everywhere.
    - An image XObject may contain its own soft-mask image in the form of a subsidiary image XObject in the **SMask** entry of the image dictionary (see “[Image Dictionaries](../c8/s9.md#895-图片字典)”). This mask, if present, shall override any explicit or colour key mask specified by the image dictionary’s **Mask** entry. Either form of mask in the image dictionary shall override the current soft mask in the graphics state.
    - An image XObject that has a **JPXDecode** filter as its data source may specify an **SMaskInData** entry, indicating that the soft mask is embedded in the data stream (see “[JPXDecode Filter](../c7/s4.md#749-jpxdecode-过滤器)”).
    
    
    !!! note "NOTE"
    
        The current soft mask in the graphics state is intended to be used to clip only a single object at a time (either an elementary object or a transparency group). If a soft mask is applied when painting two or more overlapping objects, the effect of the mask multiplies with itself in the area of overlap (except in a knockout group), producing a result shape or opacity that is probably not what is intended. To apply a soft mask to multiple objects, it is usually best to define the objects as a transparency group and apply the mask to the group as a whole. These considerations also apply to the current alpha constant (see the next sub-clause).

=== "英文"

    At most one mask input—called a *soft mask*, or *alpha mask*—shall be provided to any PDF compositing operation. The mask may serve as a source of either shape ($f_m$ ) or opacity ($q_m$ ) values, depending on the setting of the *alpha source* parameter in the graphics state (see “[Graphics State](../c8/s4.md)”). This is a boolean flag, set with the **AIS** (“alpha is shape”) entry in a graphics state parameter dictionary (“[Graphics State Parameter Dictionaries](../c8/s5.md)”): **true** if the soft mask contains shape values, **false** for opacity.
    
    The soft mask shall be specified in one of the following ways:
    
    - The *current soft mask* parameter in the graphics state, set with the **SMask** entry in a graphics state parameter dictionary, contains a soft-mask dictionary (see “[Soft-Mask Dictionaries](#11652-软掩码词典)”) defining the contents of the mask. The name **None** may be specified in place of a soft-mask dictionary, denoting the absence of a soft mask. In this case, the mask shape or opacity shall be implicitly 1.0 everywhere.
    - An image XObject may contain its own soft-mask image in the form of a subsidiary image XObject in the **SMask** entry of the image dictionary (see “[Image Dictionaries](../c8/s9.md#895-图片字典)”). This mask, if present, shall override any explicit or colour key mask specified by the image dictionary’s **Mask** entry. Either form of mask in the image dictionary shall override the current soft mask in the graphics state.
    - An image XObject that has a **JPXDecode** filter as its data source may specify an **SMaskInData** entry, indicating that the soft mask is embedded in the data stream (see “[JPXDecode Filter](../c7/s4.md#749-jpxdecode-过滤器)”).
    
    
    !!! note "NOTE"
    
        The current soft mask in the graphics state is intended to be used to clip only a single object at a time (either an elementary object or a transparency group). If a soft mask is applied when painting two or more overlapping objects, the effect of the mask multiplies with itself in the area of overlap (except in a knockout group), producing a result shape or opacity that is probably not what is intended. To apply a soft mask to multiple objects, it is usually best to define the objects as a transparency group and apply the mask to the group as a whole. These considerations also apply to the current alpha constant (see the next sub-clause).


### 11.6.4.4 恒定形状和不透明度

**Constant Shape and Opacity**

=== "中文"

    The *current alpha constant* parameter in the graphics state (see “[Graphics State](../c8/s4.md)”) shall be two scalar values—one for strokes and one for all other painting operations—to be used for the constant shape ($f_k$) or constant opacity ($q_k$) component in the colour compositing formulas.
    
    !!! note "NOTE 1"
    
        This parameter is analogous to the current colour used when painting elementary objects.
    
    The nonstroking alpha constant shall also be applied when painting a transparency group’s results onto its backdrop.
    
    The stroking and nonstroking alpha constants shall be set, respectively, by the **CA** and **ca** entries in a graphics state parameter dictionary (see “[Graphics State Parameter Dictionaries](../c8/s4.md#845-图形状态参数字典)”). As described previously for the soft mask, the alpha source flag in the graphics state shall determine whether the alpha constants are interpreted as shape values (**true**) or opacity values (**false**).
    
    !!! note "NOTE 2"
    
        The note at the end of 11.6.4.3, "[Mask Shape and Opacity](#11643-蒙版形状和不透明度)," applies to the current alpha constant parameter as well as the current soft mask.

=== "英文"

    The *current alpha constant* parameter in the graphics state (see “[Graphics State](../c8/s4.md)”) shall be two scalar values—one for strokes and one for all other painting operations—to be used for the constant shape ($f_k$) or constant opacity ($q_k$) component in the colour compositing formulas.
    
    !!! note "NOTE 1"
    
        This parameter is analogous to the current colour used when painting elementary objects.
    
    The nonstroking alpha constant shall also be applied when painting a transparency group’s results onto its backdrop.
    
    The stroking and nonstroking alpha constants shall be set, respectively, by the **CA** and **ca** entries in a graphics state parameter dictionary (see “[Graphics State Parameter Dictionaries](../c8/s4.md#845-图形状态参数字典)”). As described previously for the soft mask, the alpha source flag in the graphics state shall determine whether the alpha constants are interpreted as shape values (**true**) or opacity values (**false**).
    
    !!! note "NOTE 2"
    
        The note at the end of 11.6.4.3, "[Mask Shape and Opacity](#11643-蒙版形状和不透明度)," applies to the current alpha constant parameter as well as the current soft mask.

## 11.6.5 指定软蒙版

**Specifying Soft Masks**


### 11.6.5.1 概述

**General**

=== "中文"

    As noted under 11.6.4.3, "[Mask Shape and Opacity](#11643-蒙版形状和不透明度)," soft masks for use in compositing computations may be specified in one of the following ways:
    
    - As a soft-mask dictionary in the current soft mask parameter of the graphics state; see 11.6.5.2, "[Soft-Mask Dictionaries](#11652-软掩码词典)," for more details.
    - As a soft-mask image associated with a sampled image; see 11.6.5.3, "[Soft-Mask Images](#11653-软蒙版图像)," for more details.
    - (PDF 1.5) as a mask channel embedded in JPEG2000 encoded data; see “[JPXDecode Filter](../c7/s4.md#749-jpxdecode-过滤器)”, and the **SMaskInData** entry of Table 89 for more details.

=== "英文"

    As noted under 11.6.4.3, "[Mask Shape and Opacity](#11643-蒙版形状和不透明度)," soft masks for use in compositing computations may be specified in one of the following ways:
    
    - As a soft-mask dictionary in the current soft mask parameter of the graphics state; see 11.6.5.2, "[Soft-Mask Dictionaries](#11652-软掩码词典)," for more details.
    - As a soft-mask image associated with a sampled image; see 11.6.5.3, "[Soft-Mask Images](#11653-软蒙版图像)," for more details.
    - (PDF 1.5) as a mask channel embedded in JPEG2000 encoded data; see “[JPXDecode Filter](../c7/s4.md#749-jpxdecode-过滤器)”, and the **SMaskInData** entry of Table 89 for more details.


### 11.6.5.2 软掩码词典

**Soft-Mask Dictionaries**

=== "中文"

    The most common way of defining a soft mask is with a *soft-mask dictionary* specified as the current soft mask
    in the graphics state (see “[Graphics State](../c8/s4.md)”). Table 144 shows the contents of this type of dictionary.
    
    The mask values shall be derived from those of a transparency group, using one of the two methods described in 11.5.2, "[Deriving a Soft Mask from Group Alpha](./s5.md#1152-从-group-alpha-导出-soft-mask)," and 11.5.3, "[Deriving a Soft Mask from Group Luminosity](./s5.md#1153-根据组光度导出软蒙版)." The group shall be defined by a transparency group XObject (see “[Transparency Group XObjects](#1166-透明度组-xobjects)”) designated by the **G** entry in the soft-mask dictionary. The **S** (subtype) entry shall specify which of the two derivation methods to use:
    
    - If the subtype is **Alpha**, the transparency group XObject **G** shall be evaluated to compute a group alpha only. The colours of the constituent objects shall be ignored and the colour compositing computations shall not be performed. The transfer function **TR** shall then be applied to the computed group alpha to produce the mask values. Outside the bounding box of the transparency group, the mask value shall be the result of applying the transfer function to the input value 0.0.
    - If the subtype is **Luminosity**, the transparency group XObject **G** shall be composited with a fully opaque backdrop whose colour is everywhere defined by the soft-mask dictionary’s **BC** entry. The computed result colour shall then be converted to a single-component luminosity value, and the transfer function **TR** shall be applied to this luminosity to produce the mask values. Outside the transparency group’s bounding box, the mask value shall be derived by transforming the **BC** colour to luminosity and applying the transfer function to the result.
    
    The mask’s coordinate system shall be defined by concatenating the transformation matrix specified by the **Matrix** entry in the transparency group’s form dictionary (see “[Form Dictionaries](../c8/s10.md#8102-表单字典)”) with the current transformation matrix at the moment the soft mask is established in the graphics state with the **gs** operator.
    
    In a transparency group XObject that defines a soft mask, spot colour components shall never be available,
    even if they are available in the group or page on which the soft mask is used. If the group XObject’s content
    stream specifies a **Separation** or **DeviceN** colour space that uses spot colour components, the alternate colour
    space shall be substituted (see “[Separation Colour Spaces](../c8/s6.md#8664-分离色彩空间)” and “[DeviceN Colour Spaces](../c8/s6.md#8665-devicen-色彩空间)”).
    
    <table id="table143" markdown="span">
        <caption>**Table 143 – Entries in a soft-mask dictionary**</caption>
        <thead>
            <tr>
                <th>**Key**</th>
                <th>**Type**</th>
                <th>**Value**</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>**Type**</td>
                <td>name</td>
                <td>(Optional) The type of PDF object that this dictionary describes; if present, shall be **Mask** for a soft-mask dictionary.</td>
            </tr>
            <tr>
                <td>**S**</td>
                <td>name</td>
                <td>(Required) A subtype specifying the method to be used in deriving the mask values from the transparency group specified by the **G** entry: <br/>
                **Alpha** &emsp; The group’s computed alpha shall be used, disregarding its colour (see “Deriving a Soft Mask from Group Alpha”).
                **Luminosity** &emsp; The group’s computed colour shall be converted to a single-component luminosity value (see “Deriving a Soft Mask from Group Luminosity”).</td>
            </tr>
            <tr>
                <td>**G**</td>
                <td>stream</td>
                <td>(Required) A transparency group XObject (see “[Transparency Group XObjects](../c11/s6.md#1166-透明度组-xobjects)”) to be used as the source of alpha or colour values for deriving the mask. If the subtype **S** is **Luminosity**, the group attributes dictionary shall contain a **CS** entry defining the colour space in which the compositing computation is to be performed.</td>
            </tr>
            <tr>
                <td>**BC**</td>
                <td>array</td>
                <td>(Optional) An array of component values specifying the colour to be used as the backdrop against which to composite the transparency group XObject **G**. This entry shall be consulted only if the subtype **S** is **Luminosity**. The array shall consist of *n* numbers, where n is the number of components in the colour space specified by the **CS** entry in the group attributes dictionary (see “[Transparency Group XObjects](#1166-透明度组-xobjects)”). Default value: the colour space’s initial value, representing black.</td>
            </tr>
            <tr>
                <td>**TR**</td>
                <td>function or name</td>
                <td>(Optional) A function object (see “[Functions](../c7/s10.md#710-函数)”) specifying the transfer function to be used in deriving the mask values. The function shall accept one input, the computed group alpha or luminosity (depending on the value of the subtype **S**), and shall return one output, the resulting mask value. The input shall be in the range 0.0 to 1.0. The computed output shall be in the range 0.0 to 1.0; if it falls outside this range, it shall be forced to the nearest valid value. The name **Identity** may be specified in place of a function object to designate the identity function. Default value: **Identity**.</td>
            </tr>
        </tbody>
    </table>

=== "英文"

    The most common way of defining a soft mask is with a *soft-mask dictionary* specified as the current soft mask
    in the graphics state (see “[Graphics State](../c8/s4.md)”). Table 144 shows the contents of this type of dictionary.
    
    The mask values shall be derived from those of a transparency group, using one of the two methods described in 11.5.2, "[Deriving a Soft Mask from Group Alpha](./s5.md#1152-从-group-alpha-导出-soft-mask)," and 11.5.3, "[Deriving a Soft Mask from Group Luminosity](./s5.md#1153-根据组光度导出软蒙版)." The group shall be defined by a transparency group XObject (see “[Transparency Group XObjects](#1166-透明度组-xobjects)”) designated by the **G** entry in the soft-mask dictionary. The **S** (subtype) entry shall specify which of the two derivation methods to use:
    
    - If the subtype is **Alpha**, the transparency group XObject **G** shall be evaluated to compute a group alpha only. The colours of the constituent objects shall be ignored and the colour compositing computations shall not be performed. The transfer function **TR** shall then be applied to the computed group alpha to produce the mask values. Outside the bounding box of the transparency group, the mask value shall be the result of applying the transfer function to the input value 0.0.
    - If the subtype is **Luminosity**, the transparency group XObject **G** shall be composited with a fully opaque backdrop whose colour is everywhere defined by the soft-mask dictionary’s **BC** entry. The computed result colour shall then be converted to a single-component luminosity value, and the transfer function **TR** shall be applied to this luminosity to produce the mask values. Outside the transparency group’s bounding box, the mask value shall be derived by transforming the **BC** colour to luminosity and applying the transfer function to the result.
    
    The mask’s coordinate system shall be defined by concatenating the transformation matrix specified by the **Matrix** entry in the transparency group’s form dictionary (see “[Form Dictionaries](../c8/s10.md#8102-表单字典)”) with the current transformation matrix at the moment the soft mask is established in the graphics state with the **gs** operator.
    
    In a transparency group XObject that defines a soft mask, spot colour components shall never be available,
    even if they are available in the group or page on which the soft mask is used. If the group XObject’s content
    stream specifies a **Separation** or **DeviceN** colour space that uses spot colour components, the alternate colour
    space shall be substituted (see “[Separation Colour Spaces](../c8/s6.md#8664-分离色彩空间)” and “[DeviceN Colour Spaces](../c8/s6.md#8665-devicen-色彩空间)”).
    
    <table id="table144" markdown="span">
        <caption>**Table 144 – Entries in a soft-mask dictionary**</caption>
        <thead>
            <tr>
                <th>**Key**</th>
                <th>**Type**</th>
                <th>**Value**</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>**Type**</td>
                <td>name</td>
                <td>(Optional) The type of PDF object that this dictionary describes; if present, shall be **Mask** for a soft-mask dictionary.</td>
            </tr>
            <tr>
                <td>**S**</td>
                <td>name</td>
                <td>(Required) A subtype specifying the method to be used in deriving the mask values from the transparency group specified by the **G** entry: <br/>
                **Alpha** &emsp; The group’s computed alpha shall be used, disregarding its colour (see “Deriving a Soft Mask from Group Alpha”).
                **Luminosity** &emsp; The group’s computed colour shall be converted to a single-component luminosity value (see “Deriving a Soft Mask from Group Luminosity”).</td>
            </tr>
            <tr>
                <td>**G**</td>
                <td>stream</td>
                <td>(Required) A transparency group XObject (see “[Transparency Group XObjects](../c11/s6.md#1166-透明度组-xobjects)”) to be used as the source of alpha or colour values for deriving the mask. If the subtype **S** is **Luminosity**, the group attributes dictionary shall contain a **CS** entry defining the colour space in which the compositing computation is to be performed.</td>
            </tr>
            <tr>
                <td>**BC**</td>
                <td>array</td>
                <td>(Optional) An array of component values specifying the colour to be used as the backdrop against which to composite the transparency group XObject **G**. This entry shall be consulted only if the subtype **S** is **Luminosity**. The array shall consist of *n* numbers, where n is the number of components in the colour space specified by the **CS** entry in the group attributes dictionary (see “[Transparency Group XObjects](#1166-透明度组-xobjects)”). Default value: the colour space’s initial value, representing black.</td>
            </tr>
            <tr>
                <td>**TR**</td>
                <td>function or name</td>
                <td>(Optional) A function object (see “[Functions](../c7/s10.md#710-函数)”) specifying the transfer function to be used in deriving the mask values. The function shall accept one input, the computed group alpha or luminosity (depending on the value of the subtype **S**), and shall return one output, the resulting mask value. The input shall be in the range 0.0 to 1.0. The computed output shall be in the range 0.0 to 1.0; if it falls outside this range, it shall be forced to the nearest valid value. The name **Identity** may be specified in place of a function object to designate the identity function. Default value: **Identity**.</td>
            </tr>
        </tbody>
    </table>

### 11.6.5.3 软蒙版图像

**Soft-Mask Images**

=== "中文"

    The second way to define a soft mask is by associating a *soft-mask image* with an image XObject. This is a subsidiary image XObject specified in the **SMask** entry of the parent XObject’s image dictionary (see “[Image Dictionaries](../c8/s9.md#895-图片字典)”). Entries in the subsidiary image dictionary for such a soft-mask image shall have the same format and meaning as in that of an ordinary image XObject (as described in [Table 89](../c8/s9.md#table89) in “[Image Dictionaries](../c8/s9.md#895-图片字典)”), subject to the restrictions listed in [Table 145](#table145). This type of image dictionary may contain an additional entry, **Matte**.
    
    When an image is accompanied by a soft-mask image, it is sometimes advantageous for the image data to be *preblended* with some background colour, called the *matte colour*. Each image sample represents a weighted average of the original source colour and the matte colour, using the corresponding mask sample as the weighting factor. (This is a generalization of a technique commonly called *premultiplied alpha*.)
    
    If the image data is preblended, the matte colour shall be specified by a **Matte** entry in the soft-mask image
    dictionary (see Table 145). The preblending computation, performed independently for each component, shall
    be
    
    $$c' = m + α times (c - m)$$
    
    where
    
    $c'$ is the value to be provided in the image source data
    
    $c$ is the original image component value
    
    $m$ is the matte colour component value
    
    $α$ is the corresponding mask sample
    
    This computation shall use actual colour component values, with the effects of the **Filter** and **Decode** transformations already performed. The computation shall be the same whether the colour space is additive or subtractive.
    
    <table id="table145" markdown="span">
        <caption>**Table 145 – Restrictions on the entries in a soft-mask image dictionary**</caption>
        <thead>
            <tr>
                <th>**Key**</th>
                <th>**Restriction**</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>**Type**</td>
                <td>If present, shall be **XObject**.</td>
            </tr>
            <tr>
                <td>**Subtype**</td>
                <td>Shall be **Image**.</td>
            </tr>
            <tr>
                <td>**Width**</td>
                <td>If a **Matte** entry (see [Table 146](#table146)) is present, shall be the same as the **Width** value of the parent image; otherwise independent of it. Both images shall be mapped to the unit square in user space (as are all images), regardless of whether the samples coincide individually.</td>
            </tr>
            <tr>
                <td>**Height**</td>
                <td>Same considerations as for **Width**.</td>
            </tr>
            <tr>
                <td>**ColorSpace**</td>
                <td>Required; shall be **DeviceGray**.</td>
            </tr>
            <tr>
                <td>**BitsPerComponent**</td>
                <td>Required.</td>
            </tr>
            <tr>
                <td>**Intent**</td>
                <td>Ignored.</td>
            </tr>
            <tr>
                <td>**ImageMask**</td>
                <td>Shall be **false** or absent.</td>
            </tr>
            <tr>
                <td>**Mask**</td>
                <td>Shall be absent.</td>
            </tr>
            <tr>
                <td>**SMask**</td>
                <td>Shall be absent.</td>
            </tr>
            <tr>
                <td>**Decode**</td>
                <td>Default value: [ 0 1 ].</td>
            </tr>
            <tr>
                <td>**Interpolate**</td>
                <td>Optional.</td>
            </tr>
            <tr>
                <td>**Alternates**</td>
                <td>Ignored.</td>
            </tr>
            <tr>
                <td>**Name**</td>
                <td>Ignored.</td>
            </tr>
            <tr>
                <td>**StructParent**</td>
                <td>Ignored.</td>
            </tr>
            <tr>
                <td>**ID**</td>
                <td>Ignored.</td>
            </tr>
            <tr>
                <td>**OPI**</td>
                <td>Ignored.</td>
            </tr>
        </tbody>
    </table>
    
    
    <table id="table146" markdown="span">
        <caption>**Table 146 – Additional entry in a soft-mask image dictionary**</caption>
        <thead>
            <tr>
                <th>**Key**</th>
                <th>**Type**</th>
                <th>**Value**</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>**Matte**</td>
                <td>array</td>
                <td>(Optional; PDF 1.4) An array of component values specifying the matte colour with which the image data in the parent image shall have been preblended. The array shall consist of n numbers, where n is the number of components in the colour space specified by the **ColorSpace** entry in the parent image’s image dictionary; the numbers shall be valid colour components in that colour space. If this entry is absent, the image data shall not be preblended.</td>
            </tr>
        </tbody>
    </table>
    
    When preblended image data is used in transparency blending and compositing computations, the results shall be the same as if the original, unblended image data were used and no matte colour were specified. In particular, the inputs to the blend function shall be the original colour values. To derive c from c′, the conforming reader may sometimes need to invert the formula shown previously. The resulting c value shall lie within the range of colour component values for the image colour space.
    
    The preblending computation shall be done in the colour space specified by the parent image’s **ColorSpace** entry. This is independent of the group colour space into which the image may be painted. If a colour conversion is required, inversion of the preblending shall precede the colour conversion. If the image colour space is an **Indexed** space (see “[Indexed Colour Spaces](../c8/s6.md#8663-索引颜色空间)”), the colour values in the colour table (not the index values themselves) shall be preblended.

=== "英文"

    The second way to define a soft mask is by associating a *soft-mask image* with an image XObject. This is a subsidiary image XObject specified in the **SMask** entry of the parent XObject’s image dictionary (see “[Image Dictionaries](../c8/s9.md#895-图片字典)”). Entries in the subsidiary image dictionary for such a soft-mask image shall have the same format and meaning as in that of an ordinary image XObject (as described in [Table 89](../c8/s9.md#table89) in “[Image Dictionaries](../c8/s9.md#895-图片字典)”), subject to the restrictions listed in [Table 145](#table145). This type of image dictionary may contain an additional entry, **Matte**.
    
    When an image is accompanied by a soft-mask image, it is sometimes advantageous for the image data to be *preblended* with some background colour, called the *matte colour*. Each image sample represents a weighted average of the original source colour and the matte colour, using the corresponding mask sample as the weighting factor. (This is a generalization of a technique commonly called *premultiplied alpha*.)
    
    If the image data is preblended, the matte colour shall be specified by a **Matte** entry in the soft-mask image
    dictionary (see Table 145). The preblending computation, performed independently for each component, shall
    be
    
    $$c' = m + α \times (c - m)$$
    
    where
    
    $c'$ is the value to be provided in the image source data
    
    $c$ is the original image component value
    
    $m$ is the matte colour component value
    
    $α$ is the corresponding mask sample
    
    This computation shall use actual colour component values, with the effects of the **Filter** and **Decode** transformations already performed. The computation shall be the same whether the colour space is additive or subtractive.
    
    <table id="table145" markdown="span">
        <caption>**Table 145 – Restrictions on the entries in a soft-mask image dictionary**</caption>
        <thead>
            <tr>
                <th>**Key**</th>
                <th>**Restriction**</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>**Type**</td>
                <td>If present, shall be **XObject**.</td>
            </tr>
            <tr>
                <td>**Subtype**</td>
                <td>Shall be **Image**.</td>
            </tr>
            <tr>
                <td>**Width**</td>
                <td>If a **Matte** entry (see [Table 146](#table146)) is present, shall be the same as the **Width** value of the parent image; otherwise independent of it. Both images shall be mapped to the unit square in user space (as are all images), regardless of whether the samples coincide individually.</td>
            </tr>
            <tr>
                <td>**Height**</td>
                <td>Same considerations as for **Width**.</td>
            </tr>
            <tr>
                <td>**ColorSpace**</td>
                <td>Required; shall be **DeviceGray**.</td>
            </tr>
            <tr>
                <td>**BitsPerComponent**</td>
                <td>Required.</td>
            </tr>
            <tr>
                <td>**Intent**</td>
                <td>Ignored.</td>
            </tr>
            <tr>
                <td>**ImageMask**</td>
                <td>Shall be **false** or absent.</td>
            </tr>
            <tr>
                <td>**Mask**</td>
                <td>Shall be absent.</td>
            </tr>
            <tr>
                <td>**SMask**</td>
                <td>Shall be absent.</td>
            </tr>
            <tr>
                <td>**Decode**</td>
                <td>Default value: [ 0 1 ].</td>
            </tr>
            <tr>
                <td>**Interpolate**</td>
                <td>Optional.</td>
            </tr>
            <tr>
                <td>**Alternates**</td>
                <td>Ignored.</td>
            </tr>
            <tr>
                <td>**Name**</td>
                <td>Ignored.</td>
            </tr>
            <tr>
                <td>**StructParent**</td>
                <td>Ignored.</td>
            </tr>
            <tr>
                <td>**ID**</td>
                <td>Ignored.</td>
            </tr>
            <tr>
                <td>**OPI**</td>
                <td>Ignored.</td>
            </tr>
        </tbody>
    </table>
    
    
    <table id="table146" markdown="span">
        <caption>**Table 146 – Additional entry in a soft-mask image dictionary**</caption>
        <thead>
            <tr>
                <th>**Key**</th>
                <th>**Type**</th>
                <th>**Value**</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>**Matte**</td>
                <td>array</td>
                <td>(Optional; PDF 1.4) An array of component values specifying the matte colour with which the image data in the parent image shall have been preblended. The array shall consist of n numbers, where n is the number of components in the colour space specified by the **ColorSpace** entry in the parent image’s image dictionary; the numbers shall be valid colour components in that colour space. If this entry is absent, the image data shall not be preblended.</td>
            </tr>
        </tbody>
    </table>
    
    When preblended image data is used in transparency blending and compositing computations, the results shall be the same as if the original, unblended image data were used and no matte colour were specified. In particular, the inputs to the blend function shall be the original colour values. To derive c from c′, the conforming reader may sometimes need to invert the formula shown previously. The resulting c value shall lie within the range of colour component values for the image colour space.
    
    The preblending computation shall be done in the colour space specified by the parent image’s **ColorSpace** entry. This is independent of the group colour space into which the image may be painted. If a colour conversion is required, inversion of the preblending shall precede the colour conversion. If the image colour space is an **Indexed** space (see “[Indexed Colour Spaces](../c8/s6.md#8663-索引颜色空间)”), the colour values in the colour table (not the index values themselves) shall be preblended.

## 11.6.6 透明度组 XObjects

**Transparency Group XObjects**

=== "中文"

    A transparency group is represented in PDF as a special type of group XObject (see “[Group XObjects](../c8/s10.md#8103-xobject-组合)”) called a *transparency group XObject*. A group XObject is in turn a type of form XObject, distinguished by the presence of a **Group** entry in its form dictionary (see “[Form Dictionaries](../c8/s10.md#8102-表单字典)”). The value of this entry is a subsidiary group attributes dictionary defining the properties of the group. The format and meaning of the dictionary’s contents shall be determined by its group subtype, which is specified by the dictionary’s S entry. The entries for a transparency group (subtype **Transparency**) are shown in [Table 147](#table147).
    
    A page object (see “[Page Objects](../c7/s7.md#7733-page对象)”) may also have a **Group** entry, whose value is a group attributes dictionary specifying the attributes of the page group (see “[Page Group](./s4.md#1147-page组)”). Some of the dictionary entries are interpreted slightly differently for a page group than for a transparency group XObject; see their descriptions in the table for details.
        
    <table id="table147" markdown="span">
        <caption>**Table 147 – Additional entries specific to a transparency group attributes dictionary**</caption>
        <thead>
            <tr>
                <th>**Key**</th>
                <th>**Type**</th>
                <th>**Value**</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>**S**</td>
                <td>name</td>
                <td>(Required) The group subtype, which identifies the type of group whose attributes this dictionary describes; shall be **Transparency** for a transparency group.</td>
            </tr>
            <tr>
                <td>**CS**</td>
                <td>name or array</td>
                <td>
                    (Sometimes required) The group colour space, which is used for the following purposes:
                    <ul><li>
                    As the colour space into which colours shall be converted when painted into the group</li><li>
                    As the blending colour space in which objects shall be composited within the group (see “[Blending Colour Space](./s3.md#1134-混合色彩空间)”)</li><li>
                    As the colour space of the group as a whole when it in turn is painted as an object onto its backdrop</li></ul>
                    The group colour space shall be any device or CIE-based colour space that treats its components as independent additive or subtractive values in the range 0.0 to 1.0, subject to the restrictions described in [11.3.4], "[Blending Colour Space](./s3.md#1134-混合色彩空间)." These restrictions exclude **Lab** and lightness- chromaticity **ICCBased** colour spaces, as well as the special colour spaces **Pattern**, **Indexed**, **Separation**, and **DeviceN**. Device colour spaces shall be subject to remapping according to the **DefaultGray**, **DefaultRGB**, and **DefaultCMYK** entries in the **ColorSpace** subdictionary of the current resource dictionary (see “[Default Colour Spaces](../c8/s6.md#8656-默认颜色空间)”).<br/>
                    Ordinarily, the **CS** entry may be present only for isolated transparency groups (those for which **I** is **true**), and even then it is optional. However, this entry shall be present in the group attributes dictionary for any transparency group XObject that has no parent group or page from which to inherit—in particular, one that is the value of the **G** entry in a soft-mask dictionary of subtype **Luminosity** (see “[Soft-Mask Dictionaries](#11652-软掩码词典)”).<br/>
                    Additionally, the **CS** entry may be present in the group attributes dictionary associated with a page object, even if **I** is **false** or absent. In the normal case in which the page is imposed directly on the output medium, the page group is effectively isolated regardless of the I value, and the specified **CS** value shall therefore be honoured. But if the page is in turn used as an element of some other page and if the group is non- isolated, **CS** shall be ignored and the colour space shall be inherited from the actual backdrop with which the page is composited (see “[Page Group](./s4.md#1147-page组)”).<br/>
                    Default value: the colour space of the parent group or page into which this transparency group is painted. (The parent’s colour space in turn may be either explicitly specified or inherited.)<br/>
                    For a transparency group XObject used as an annotation appearance (see “[Appearance Streams](../c12/s5.md#1255-外观流)”), the default colour space shall be inherited from the page on which the annotation appears.
                </td>
            </tr>
            <tr>
                <td>**I**</td>
                <td>boolean</td>
                <td>(Optional) A flag specifying whether the transparency group is isolated (see “[Isolated Groups](./s4.md#1145-孤立团体)”). If this flag is **true**, objects within the group shall be composited against a fully transparent initial backdrop; if **false**, they shall be composited against the group’s backdrop. Default value: **false**.<br/>
                In the group attributes dictionary for a page, the interpretation of this entry shall be slightly altered. In the normal case in which the page is imposed directly on the output medium, the page group is effectively isolated and the specified **I** value shall be ignored. But if the page is in turn used as an element of some other page, it shall be treated as if it were a transparency group XObject; the **I** value shall be interpreted in the normal way to determine whether the page group is isolated.</td>
            </tr>
            <tr>
                <td>**K**</td>
                <td>boolean</td>
                <td>(Optional) A flag specifying whether the transparency group is a knockout group (see “[Knockout Groups](./s4.md#1146-knockout-组)”). If this flag is **false**, later objects within the group shall be composited with earlier ones with which they overlap; if **true**, they shall be composited with the group’s initial backdrop and shall overwrite (“knock out”) any earlier overlapping objects. Default value: **false**.</td>
            </tr>
        </tbody>
    </table>
    
    The transparency group XObject’s content stream shall define the graphics objects belonging to the group. When applied to a transparency group XObject, the **Do** operator shall execute its content stream and shall composite the resulting group colour, shape, and opacity into the group’s parent group or page as if they had come from an elementary graphics object. **Do** shall perform the following actions in addition to the normal ones for a form XObject (as described in “[Form XObjects](../c8/s10.md)”):
    
    - If the transparency group is non-isolated (the value of the **I** entry in its group attributes dictionary is **false**), its initial backdrop, within the bounding box specified by the XObject’s **BBox** entry, shall be defined to be the accumulated colour and alpha of the parent group or page—that is, the result of everything that has been painted in the parent up to that point. However, if the parent is a knockout group, the initial backdrop shall be the same as that of the parent. If the group is isolated (**I** is **true**), its initial backdrop shall be defined to be transparent.
    - Before execution of the transparency group XObject’s content stream, the current blend mode in the graphics state shall be initialized to **Normal**, the current stroking and nonstroking alpha constants to 1.0, and the current soft mask to **None**.
    
    !!! note "NOTE 1"
    
        The purpose of initializing these graphics state parameters at the beginning of execution is to ensure that they are not applied twice: once when member objects are painted into the group and again when the group is painted into the parent group or page.
    
    - Objects painted by operators in the transparency group XObject’s content stream shall be composited into the group according to the rules described in [11.3.3], "[Basic Compositing Formula](./s3.md#1133-基本合成公式)." The knockout flag (**K**) in the group attributes dictionary and the transparency-related parameters of the graphics state shall be honoured during this computation.
    - If a group colour space (**CS**) is specified in the group attributes dictionary, all painting operators shall convert source colours to that colour space before compositing objects into the group, and the resulting colour at each point shall be interpreted in that colour space. If no group colour space is specified, the prevailing colour space shall be dynamically inherited from the parent group or page. (If not otherwise specified, the page group’s colour space shall be inherited from the native colour space of the output device.)
    - After execution of the transparency group XObject’s content stream, the graphics state shall revert to its former state before the invocation of the **Do** operator (as it does for any form XObject). The group’s shape—the union of all objects painted into the group, clipped by the group XObject’s bounding box— shall then be painted into the parent group or page, using the group’s accumulated colour and opacity at each point.
    
    If the **Do** operator is invoked more than once for a given transparency group XObject, each invocation shall be treated as a separate transparency group. That is, the result shall be as if the group were independently composited with the backdrop on each invocation.
    
    !!! note "NOTE 2"
        
        Applications that perform caching of rendered form XObjects shall take this requirement into account.
    
    The actions described previously shall occur only for a transparency group XObject—a form XObject having a **Group** entry that designates a group attributes subdictionary whose group subtype (**S**) is **Transparency**. An ordinary form XObject—one having no **Group** entry—shall not be subject to any grouping behaviour for transparency purposes. That is, the graphics objects it contains shall be composited individually, just as if they were painted directly into the parent group or page.

=== "英文"

    A transparency group is represented in PDF as a special type of group XObject (see “[Group XObjects](../c8/s10.md#8103-xobject-组合)”) called a *transparency group XObject*. A group XObject is in turn a type of form XObject, distinguished by the presence of a **Group** entry in its form dictionary (see “[Form Dictionaries](../c8/s10.md#8102-表单字典)”). The value of this entry is a subsidiary group attributes dictionary defining the properties of the group. The format and meaning of the dictionary’s contents shall be determined by its group subtype, which is specified by the dictionary’s S entry. The entries for a transparency group (subtype **Transparency**) are shown in [Table 147](#table147).
    
    A page object (see “[Page Objects](../c7/s7.md#7733-page对象)”) may also have a **Group** entry, whose value is a group attributes dictionary specifying the attributes of the page group (see “[Page Group](./s4.md#1147-page组)”). Some of the dictionary entries are interpreted slightly differently for a page group than for a transparency group XObject; see their descriptions in the table for details.
        
    <table id="table147" markdown="span">
        <caption>**Table 147 – Additional entries specific to a transparency group attributes dictionary**</caption>
        <thead>
            <tr>
                <th>**Key**</th>
                <th>**Type**</th>
                <th>**Value**</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>**S**</td>
                <td>name</td>
                <td>(Required) The group subtype, which identifies the type of group whose attributes this dictionary describes; shall be **Transparency** for a transparency group.</td>
            </tr>
            <tr>
                <td>**CS**</td>
                <td>name or array</td>
                <td>
                    (Sometimes required) The group colour space, which is used for the following purposes:
                    <ul><li>
                    As the colour space into which colours shall be converted when painted into the group</li><li>
                    As the blending colour space in which objects shall be composited within the group (see “[Blending Colour Space](./s3.md#1134-混合色彩空间)”)</li><li>
                    As the colour space of the group as a whole when it in turn is painted as an object onto its backdrop</li></ul>
                    The group colour space shall be any device or CIE-based colour space that treats its components as independent additive or subtractive values in the range 0.0 to 1.0, subject to the restrictions described in [11.3.4], "[Blending Colour Space](./s3.md#1134-混合色彩空间)." These restrictions exclude **Lab** and lightness- chromaticity **ICCBased** colour spaces, as well as the special colour spaces **Pattern**, **Indexed**, **Separation**, and **DeviceN**. Device colour spaces shall be subject to remapping according to the **DefaultGray**, **DefaultRGB**, and **DefaultCMYK** entries in the **ColorSpace** subdictionary of the current resource dictionary (see “[Default Colour Spaces](../c8/s6.md#8656-默认颜色空间)”).<br/>
                    Ordinarily, the **CS** entry may be present only for isolated transparency groups (those for which **I** is **true**), and even then it is optional. However, this entry shall be present in the group attributes dictionary for any transparency group XObject that has no parent group or page from which to inherit—in particular, one that is the value of the **G** entry in a soft-mask dictionary of subtype **Luminosity** (see “[Soft-Mask Dictionaries](#11652-软掩码词典)”).<br/>
                    Additionally, the **CS** entry may be present in the group attributes dictionary associated with a page object, even if **I** is **false** or absent. In the normal case in which the page is imposed directly on the output medium, the page group is effectively isolated regardless of the I value, and the specified **CS** value shall therefore be honoured. But if the page is in turn used as an element of some other page and if the group is non- isolated, **CS** shall be ignored and the colour space shall be inherited from the actual backdrop with which the page is composited (see “[Page Group](./s4.md#1147-page组)”).<br/>
                    Default value: the colour space of the parent group or page into which this transparency group is painted. (The parent’s colour space in turn may be either explicitly specified or inherited.)<br/>
                    For a transparency group XObject used as an annotation appearance (see “[Appearance Streams](../c12/s5.md#1255-外观流)”), the default colour space shall be inherited from the page on which the annotation appears.
                </td>
            </tr>
            <tr>
                <td>**I**</td>
                <td>boolean</td>
                <td>(Optional) A flag specifying whether the transparency group is isolated (see “[Isolated Groups](./s4.md#1145-孤立团体)”). If this flag is **true**, objects within the group shall be composited against a fully transparent initial backdrop; if **false**, they shall be composited against the group’s backdrop. Default value: **false**.<br/>
                In the group attributes dictionary for a page, the interpretation of this entry shall be slightly altered. In the normal case in which the page is imposed directly on the output medium, the page group is effectively isolated and the specified **I** value shall be ignored. But if the page is in turn used as an element of some other page, it shall be treated as if it were a transparency group XObject; the **I** value shall be interpreted in the normal way to determine whether the page group is isolated.</td>
            </tr>
            <tr>
                <td>**K**</td>
                <td>boolean</td>
                <td>(Optional) A flag specifying whether the transparency group is a knockout group (see “[Knockout Groups](./s4.md#1146-knockout-组)”). If this flag is **false**, later objects within the group shall be composited with earlier ones with which they overlap; if **true**, they shall be composited with the group’s initial backdrop and shall overwrite (“knock out”) any earlier overlapping objects. Default value: **false**.</td>
            </tr>
        </tbody>
    </table>
    
    The transparency group XObject’s content stream shall define the graphics objects belonging to the group. When applied to a transparency group XObject, the **Do** operator shall execute its content stream and shall composite the resulting group colour, shape, and opacity into the group’s parent group or page as if they had come from an elementary graphics object. **Do** shall perform the following actions in addition to the normal ones for a form XObject (as described in “[Form XObjects](../c8/s10.md)”):
    
    - If the transparency group is non-isolated (the value of the **I** entry in its group attributes dictionary is **false**), its initial backdrop, within the bounding box specified by the XObject’s **BBox** entry, shall be defined to be the accumulated colour and alpha of the parent group or page—that is, the result of everything that has been painted in the parent up to that point. However, if the parent is a knockout group, the initial backdrop shall be the same as that of the parent. If the group is isolated (**I** is **true**), its initial backdrop shall be defined to be transparent.
    - Before execution of the transparency group XObject’s content stream, the current blend mode in the graphics state shall be initialized to **Normal**, the current stroking and nonstroking alpha constants to 1.0, and the current soft mask to **None**.
    
    !!! note "NOTE 1"
    
        The purpose of initializing these graphics state parameters at the beginning of execution is to ensure that they are not applied twice: once when member objects are painted into the group and again when the group is painted into the parent group or page.
    
    - Objects painted by operators in the transparency group XObject’s content stream shall be composited into the group according to the rules described in [11.3.3], "[Basic Compositing Formula](./s3.md#1133-基本合成公式)." The knockout flag (**K**) in the group attributes dictionary and the transparency-related parameters of the graphics state shall be honoured during this computation.
    - If a group colour space (**CS**) is specified in the group attributes dictionary, all painting operators shall convert source colours to that colour space before compositing objects into the group, and the resulting colour at each point shall be interpreted in that colour space. If no group colour space is specified, the prevailing colour space shall be dynamically inherited from the parent group or page. (If not otherwise specified, the page group’s colour space shall be inherited from the native colour space of the output device.)
    - After execution of the transparency group XObject’s content stream, the graphics state shall revert to its former state before the invocation of the **Do** operator (as it does for any form XObject). The group’s shape—the union of all objects painted into the group, clipped by the group XObject’s bounding box— shall then be painted into the parent group or page, using the group’s accumulated colour and opacity at each point.
    
    If the **Do** operator is invoked more than once for a given transparency group XObject, each invocation shall be treated as a separate transparency group. That is, the result shall be as if the group were independently composited with the backdrop on each invocation.
    
    !!! note "NOTE 2"
        
        Applications that perform caching of rendered form XObjects shall take this requirement into account.
    
    The actions described previously shall occur only for a transparency group XObject—a form XObject having a **Group** entry that designates a group attributes subdictionary whose group subtype (**S**) is **Transparency**. An ordinary form XObject—one having no **Group** entry—shall not be subject to any grouping behaviour for transparency purposes. That is, the graphics objects it contains shall be composited individually, just as if they were painted directly into the parent group or page.

## 11.6.7 图案和透明度

**Patterns and Transparency**

=== "中文"

    In the transparent imaging model, the graphics objects making up the pattern cell of a tiling pattern (see “[Tiling Patterns](../c8/s7.md#873-平铺图案)”) may include transparent objects and transparency groups. Transparent compositing may occur both within the pattern cell and between it and the backdrop wherever the pattern is painted. Similarly, a shading pattern (“[Shading Patterns](../c8/s7.md#874-底纹图案)”) composites with its backdrop as if the shading dictionary were applied with the **sh** operator.
    
    In both cases, the pattern definition shall be treated as if it were implicitly enclosed in a non-isolated transparency group: a non-knockout group for tiling patterns, a knockout group for shading patterns. The definition shall not inherit the current values of the graphics state parameters at the time it is evaluated; those parameters shall take effect only when the resulting pattern is later used to paint an object. Instead, the graphics state parameters shall be initialized as follows:
    
    - As always for transparency groups, those parameters related to transparency (blend mode, soft mask, and alpha constant) shall be initialized to their standard default values.
    - All other parameters shall be initialized to their values at the beginning of the content stream (such as a page or a form XObject) in which the pattern shall be defined as a resource. (This is the normal behaviour for all patterns, in both the opaque and transparent imaging models.)
    - In the case of a shading pattern, the parameter values may be augmented by the contents of the **ExtGState** entry in the pattern dictionary (see “[Shading Patterns](../c8/s7.md#874-底纹图案)”). Only those parameters that affect the **sh** operator, such as the current transformation matrix and rendering intent, shall be used. Parameters that affect path-painting operators shall not be used, since the execution of **sh** does not entail painting a path.
    - If the shading dictionary has a **Background** entry, the pattern’s implicit transparency group shall be filled with the specified background colour before the **sh** operator is invoked.
    
    When the pattern is later used to paint a graphics object, the colour, shape, and opacity values resulting from the evaluation of the pattern definition shall be used as the object’s source colour ($C_s$ ), object shape ($f_j$ ), and object opacity ($q_j$ ) in the transparency compositing formulas. This painting operation is subject to the values of he graphics state parameters in effect at the time, just as in painting an object with a constant colour.
    
    !!! note "NOTE 1"
    
        Unlike the opaque imaging model, in which the pattern cell of a tiling pattern may be evaluated once and then replicated indefinitely to fill the painted area, the effect in the general transparent case is as if the pattern definition were reexecuted independently for each tile, taking into account the colour of the backdrop at each point. However, in the common case in which the pattern consists entirely of objects painted with the **Normal** blend mode, this behaviour can be optimized by treating the pattern cell as if it were an isolated group. Since in this case the results depend only on the colour, shape, and opacity of the pattern cell and not on those of the backdrop, the pattern cell can be evaluated once and then replicated, just as in opaque painting.
    
    !!! note "NOTE 2"
    
        In a raster-based implementation of tiling, all tiles should be treated as a single transparency group. This avoids artifacts due to multiple marking of pixels along the boundaries between adjacent tiles.
    
    The foregoing discussion applies to both coloured (**PaintType** 1) and uncoloured (**PaintType** 2) tiling patterns. In the latter case, the restriction that an uncoloured pattern’s definition shall not specify colours extends as well to any transparency group that the definition may include. There are no corresponding restrictions, however, on specifying transparency-related parameters in the graphics state.

=== "英文"

    In the transparent imaging model, the graphics objects making up the pattern cell of a tiling pattern (see “[Tiling Patterns](../c8/s7.md#873-平铺图案)”) may include transparent objects and transparency groups. Transparent compositing may occur both within the pattern cell and between it and the backdrop wherever the pattern is painted. Similarly, a shading pattern (“[Shading Patterns](../c8/s7.md#874-底纹图案)”) composites with its backdrop as if the shading dictionary were applied with the **sh** operator.
    
    In both cases, the pattern definition shall be treated as if it were implicitly enclosed in a non-isolated transparency group: a non-knockout group for tiling patterns, a knockout group for shading patterns. The definition shall not inherit the current values of the graphics state parameters at the time it is evaluated; those parameters shall take effect only when the resulting pattern is later used to paint an object. Instead, the graphics state parameters shall be initialized as follows:
    
    - As always for transparency groups, those parameters related to transparency (blend mode, soft mask, and alpha constant) shall be initialized to their standard default values.
    - All other parameters shall be initialized to their values at the beginning of the content stream (such as a page or a form XObject) in which the pattern shall be defined as a resource. (This is the normal behaviour for all patterns, in both the opaque and transparent imaging models.)
    - In the case of a shading pattern, the parameter values may be augmented by the contents of the **ExtGState** entry in the pattern dictionary (see “[Shading Patterns](../c8/s7.md#874-底纹图案)”). Only those parameters that affect the **sh** operator, such as the current transformation matrix and rendering intent, shall be used. Parameters that affect path-painting operators shall not be used, since the execution of **sh** does not entail painting a path.
    - If the shading dictionary has a **Background** entry, the pattern’s implicit transparency group shall be filled with the specified background colour before the **sh** operator is invoked.
    
    When the pattern is later used to paint a graphics object, the colour, shape, and opacity values resulting from the evaluation of the pattern definition shall be used as the object’s source colour ($C_s$ ), object shape ($f_j$ ), and object opacity ($q_j$ ) in the transparency compositing formulas. This painting operation is subject to the values of he graphics state parameters in effect at the time, just as in painting an object with a constant colour.
    
    !!! note "NOTE 1"
    
        Unlike the opaque imaging model, in which the pattern cell of a tiling pattern may be evaluated once and then replicated indefinitely to fill the painted area, the effect in the general transparent case is as if the pattern definition were reexecuted independently for each tile, taking into account the colour of the backdrop at each point. However, in the common case in which the pattern consists entirely of objects painted with the **Normal** blend mode, this behaviour can be optimized by treating the pattern cell as if it were an isolated group. Since in this case the results depend only on the colour, shape, and opacity of the pattern cell and not on those of the backdrop, the pattern cell can be evaluated once and then replicated, just as in opaque painting.
    
    !!! note "NOTE 2"
    
        In a raster-based implementation of tiling, all tiles should be treated as a single transparency group. This avoids artifacts due to multiple marking of pixels along the boundaries between adjacent tiles.
    
    The foregoing discussion applies to both coloured (**PaintType** 1) and uncoloured (**PaintType** 2) tiling patterns. In the latter case, the restriction that an uncoloured pattern’s definition shall not specify colours extends as well to any transparency group that the definition may include. There are no corresponding restrictions, however, on specifying transparency-related parameters in the graphics state.


[8.10.2]: ../c8/s10.md#8102-表单字典
[8.10.3]: ../c8/s10.md#8103-xobject-组合

[11.3.3]: ../c11/s3.md#1133-基本合成公式
[11.3.4]: ../c11/s3.md#1134-混合色彩空间
[11.3.5]: ../c11/s3.md#1135-混合模式
[11.6.6]: ../c11/s6.md#1166-透明度组-xobjects

[11.7.4.2]: ../c11/s7.md#11742-混合模式和叠印
[11.7.4.3]: ../c11/s7.md#11743-与不透明套印的兼容性
[11.3.7.2]: ../c11/s3.md#11372-源形状和不透明度