# 11.4 透明度组

**Transparency Groups**

## 11.4.1 概述

**General**

=== "中文"

    A *transparency group* is a sequence of consecutive objects in a transparency stack that shall be collected together and composited to produce a single colour, shape, and opacity at each point. The result shall then be treated as if it were a single object for subsequent compositing operations. Groups may be nested within other groups to form a tree-structured group hierarchy.
    
    !!! note "NOTE"
    
        This facilitates creating independent pieces of artwork, each composed of multiple objects, and then combining them, possibly with additional transparency effects applied during the combination.
    
    The objects contained within a group shall be treated as a separate transparency stack called the *group stack*. The objects in the stack shall be composited against an initial backdrop (discussed later), producing a composite colour, shape, and opacity for the group as a whole. The result is an object whose shape is the union of the shapes of its constituent objects and whose colour and opacity are the result of the compositing operations. This object shall then be composited with the group’s backdrop in the usual way.
    
    In addition to its computed colour, shape, and opacity, the group as a whole may have several further attributes:
    
    - All of the input variables that affect the compositing computation for individual objects may also be applied when compositing the group with its backdrop. These variables include mask and constant shape, mask and constant opacity, and blend mode.
    - The group may be *isolated* or *non-isolated*, which shall determine the initial backdrop against which its stack is composited.
    - The group may be *knockout* or *non-knockout*, which shall determine whether the objects within its stack are composited with one another or only with the group’s backdrop.
    - An isolated group may specify its own blending colour space, independent of that of the group’s backdrop.
    - Instead of being composited onto the current page, a group’s results may be used as a source of shape or opacity values for creating a *soft mask* (see “[Soft Masks](./s5.md)”).

=== "英文"

    A *transparency group* is a sequence of consecutive objects in a transparency stack that shall be collected together and composited to produce a single colour, shape, and opacity at each point. The result shall then be treated as if it were a single object for subsequent compositing operations. Groups may be nested within other groups to form a tree-structured group hierarchy.
    
    !!! note "NOTE"
    
        This facilitates creating independent pieces of artwork, each composed of multiple objects, and then combining them, possibly with additional transparency effects applied during the combination.
    
    The objects contained within a group shall be treated as a separate transparency stack called the *group stack*. The objects in the stack shall be composited against an initial backdrop (discussed later), producing a composite colour, shape, and opacity for the group as a whole. The result is an object whose shape is the union of the shapes of its constituent objects and whose colour and opacity are the result of the compositing operations. This object shall then be composited with the group’s backdrop in the usual way.
    
    In addition to its computed colour, shape, and opacity, the group as a whole may have several further attributes:
    
    - All of the input variables that affect the compositing computation for individual objects may also be applied when compositing the group with its backdrop. These variables include mask and constant shape, mask and constant opacity, and blend mode.
    - The group may be *isolated* or *non-isolated*, which shall determine the initial backdrop against which its stack is composited.
    - The group may be *knockout* or *non-knockout*, which shall determine whether the objects within its stack are composited with one another or only with the group’s backdrop.
    - An isolated group may specify its own blending colour space, independent of that of the group’s backdrop.
    - Instead of being composited onto the current page, a group’s results may be used as a source of shape or opacity values for creating a *soft mask* (see “[Soft Masks](./s5.md)”).


## 11.4.2 组合成计算的符号

**Notation for Group Compositing Computations**

=== "中文"

    This sub-clause introduces some notation for dealing with group compositing. Subsequent sub-clauses describe the group compositing formulas for a non-isolated, non-knockout group and the special properties of isolated and knockout groups.
    
    Since we are now dealing with multiple objects at a time, it is useful to have some notation for distinguishing among them. Accordingly, the variables introduced earlier are altered to include a second-level subscript denoting an object’s position in the transparency stack.
    
    $C_{s_i}$ stands for the source colour of the ith object in the stack. The subscript 0 represents the initial backdrop; subscripts 1 to n denote the bottommost to topmost objects in an n-element stack. In addition, the subscripts b and *r* are dropped from the variables $C_b$ , $f_β$ , $q_β$ , $α_β$ , $C_r$, $f_ρ$ , $q_ρ$ , and $α_ρ$ ; other variables retain their mnemonic subscripts.
    
    These conventions permit the compositing formulas to be restated as recurrence relations among the elements of a stack. For instance, the result of the colour compositing computation for object *i* is denoted by $C_i$ (formerly $C_r$ ). This computation takes as one of its inputs the immediate backdrop colour, which is the result of the colour compositing computation for object *i − 1*; this is denoted by $C_{i − 1}$ (formerly $C_b$ ).
    
    The revised formulas for a simple n-element stack (not including any groups) shall be, for *i = 1, … , n*:
    
    $\begin{align} 
      &f_{s_i} = f_{j_i} \times f_{m_i} \times f_{k_i} \\
      &q_{s_i} = q_{j_i} \times q_{m_i} \times q_{k_i} \\\\
      &\alpha _{s_i} = f_{s_i} \times q_{s_i} \\
      &\alpha _i = \text{Union}(\alpha _{i-1}, \alpha _{s_i})\\\\
      &f_i = \text{Union}(f_{i-1}, f_{s_i}) \\
      &q_i = \frac{\alpha _i}{\alpha _i} \\\\
      &C_i = \left ( 1- \frac{\alpha _{s_i}}{\alpha _i} \right) \times C_{i-1} + \frac{\alpha _{s_i}}{\alpha _i} \times [(1-\alpha _{i-1}) \times C_{s_i} + \alpha _{i-1} \times B_i(C_{i-1}, C_{s_i})] 
    \end{align}$
    
    where the variables have the meanings shown in Table 140.
    
    !!! note "NOTE"
    
        Compare these formulas with those shown in [11.3.8], "Summary of Basic Compositing Computations."
                   
    <table id="table140" markdown="span">
        <caption>**Table 140 – Revised variables for the basic compositing formulas**</caption>
        <thead>
            <tr>
                <th>**Variable**</th>
                <th>**Meaning**</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>$f_{s_i}$</td>
                <td>Source shape for object *i*</td>
            </tr>
            <tr>
                <td>$f_{j_i}$</td>
                <td>Object shape for object *i*</td>
            </tr>
            <tr>
                <td>$f_{m_i}$</td>
                <td>Mask shape for object *i*</td>
            </tr>
            <tr>
                <td>$f_{k_i}$</td>
                <td>Constant shape for object *i*</td>
            </tr>
            <tr>
                <td>$f_i$</td>
                <td>Result shape after compositing object *i*</td>
            </tr>
            <tr>
                <td>$q_{s_i}$</td>
                <td>Source opacity for object *i*</td>
            </tr>
            <tr>
                <td>$q_{j_i}$</td>
                <td>Object opacity for object *i*</td>
            </tr>
            <tr>
                <td>$q_{m_i}$</td>
                <td>Mask opacity for object *i*</td>
            </tr>
            <tr>
                <td>$q_{k_i}$</td>
                <td>Constant opacity for object *i*</td>
            </tr>
            <tr>
                <td>$q_i$</td>
                <td>Result opacity after compositing object *i*</td>
            </tr>
            <tr>
                <td>$\alpha_{s_i}$</td>
                <td>Source alpha for object *i*</td>
            </tr>
            <tr>
                <td>$\alpha_i$</td>
                <td>Result alpha after compositing object *i*</td>
            </tr>
            <tr>
                <td>$C_{s_i}$</td>
                <td>Source colour for object *i*</td>
            </tr>
            <tr>
                <td>$C_i$</td>
                <td>Result colour after compositing object *i*</td>
            </tr>
            <tr>
                <td>$B_i(C_{i-1}, C_{s_i})$</td>
                <td>Blend function for object *i*</td>
            </tr>
        </tbody>
    </table>

=== "英文"

    This sub-clause introduces some notation for dealing with group compositing. Subsequent sub-clauses describe the group compositing formulas for a non-isolated, non-knockout group and the special properties of isolated and knockout groups.
    
    Since we are now dealing with multiple objects at a time, it is useful to have some notation for distinguishing among them. Accordingly, the variables introduced earlier are altered to include a second-level subscript denoting an object’s position in the transparency stack.
    
    $C_{s_i}$ stands for the source colour of the ith object in the stack. The subscript 0 represents the initial backdrop; subscripts 1 to n denote the bottommost to topmost objects in an n-element stack. In addition, the subscripts b and *r* are dropped from the variables $C_b$ , $f_β$ , $q_β$ , $α_β$ , $C_r$, $f_ρ$ , $q_ρ$ , and $α_ρ$ ; other variables retain their mnemonic subscripts.
    
    These conventions permit the compositing formulas to be restated as recurrence relations among the elements of a stack. For instance, the result of the colour compositing computation for object *i* is denoted by $C_i$ (formerly $C_r$ ). This computation takes as one of its inputs the immediate backdrop colour, which is the result of the colour compositing computation for object *i − 1*; this is denoted by $C_{i − 1}$ (formerly $C_b$ ).
    
    The revised formulas for a simple n-element stack (not including any groups) shall be, for *i = 1, … , n*:
    
    $\begin{align} 
      &f_{s_i} = f_{j_i} \times f_{m_i} \times f_{k_i} \\
      &q_{s_i} = q_{j_i} \times q_{m_i} \times q_{k_i} \\\\
      &\alpha _{s_i} = f_{s_i} \times q_{s_i} \\
      &\alpha _i = \text{Union}(\alpha _{i-1}, \alpha _{s_i})\\\\
      &f_i = \text{Union}(f_{i-1}, f_{s_i}) \\
      &q_i = \frac{\alpha _i}{\alpha _i} \\\\
      &C_i = \left ( 1- \frac{\alpha _{s_i}}{\alpha _i} \right) \times C_{i-1} + \frac{\alpha _{s_i}}{\alpha _i} \times [(1-\alpha _{i-1}) \times C_{s_i} + \alpha _{i-1} \times B_i(C_{i-1}, C_{s_i})] 
    \end{align}$
    
    where the variables have the meanings shown in Table 140.
    
    !!! note "NOTE"
    
        Compare these formulas with those shown in [11.3.8], "Summary of Basic Compositing Computations."
                   
    <table id="table140" markdown="span">
        <caption>**Table 140 – Revised variables for the basic compositing formulas**</caption>
        <thead>
            <tr>
                <th>**Variable**</th>
                <th>**Meaning**</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>$f_{s_i}$</td>
                <td>Source shape for object *i*</td>
            </tr>
            <tr>
                <td>$f_{j_i}$</td>
                <td>Object shape for object *i*</td>
            </tr>
            <tr>
                <td>$f_{m_i}$</td>
                <td>Mask shape for object *i*</td>
            </tr>
            <tr>
                <td>$f_{k_i}$</td>
                <td>Constant shape for object *i*</td>
            </tr>
            <tr>
                <td>$f_i$</td>
                <td>Result shape after compositing object *i*</td>
            </tr>
            <tr>
                <td>$q_{s_i}$</td>
                <td>Source opacity for object *i*</td>
            </tr>
            <tr>
                <td>$q_{j_i}$</td>
                <td>Object opacity for object *i*</td>
            </tr>
            <tr>
                <td>$q_{m_i}$</td>
                <td>Mask opacity for object *i*</td>
            </tr>
            <tr>
                <td>$q_{k_i}$</td>
                <td>Constant opacity for object *i*</td>
            </tr>
            <tr>
                <td>$q_i$</td>
                <td>Result opacity after compositing object *i*</td>
            </tr>
            <tr>
                <td>$\alpha_{s_i}$</td>
                <td>Source alpha for object *i*</td>
            </tr>
            <tr>
                <td>$\alpha_i$</td>
                <td>Result alpha after compositing object *i*</td>
            </tr>
            <tr>
                <td>$C_{s_i}$</td>
                <td>Source colour for object *i*</td>
            </tr>
            <tr>
                <td>$C_i$</td>
                <td>Result colour after compositing object *i*</td>
            </tr>
            <tr>
                <td>$B_i(C_{i-1}, C_{s_i})$</td>
                <td>Blend function for object *i*</td>
            </tr>
        </tbody>
    </table>

## 11.4.3 群体结构和命名法

**Group Structure and Nomenclature**

=== "中文"

    As stated earlier, the elements of a group shall be treated as a separate transparency stack, referred to as the group stack. These objects shall be composited against a selected initial backdrop and the resulting colour, shape, and opacity shall then be treated as if they belonged to a single object. The resulting object is in turn composited with the group’s backdrop in the usual way.
    
    !!! note "NOTE"
    
        This computation entails interpreting the stack as a tree. For an *n-element* group that begins at position i in the stack, it treats the next n objects as an *n-element* substack, whose elements are given an independent numbering of 1 to *n*. These objects are then removed from the object numbering in the parent (containing) stack and replaced by the group object, numbered i, followed by the remaining objects to be painted on top of the group, renumbered starting at *i + 1*. This operation applies recursively to any nested subgroups.
    
    The term *element* (denoted $E_i$ ) refers to a member of some group; it can be either an individual object or a contained subgroup.
    
    From the perspective of a particular element in a nested group, there are three different backdrops of interest:
    
    - The *group backdrop* is the result of compositing all elements up to but not including the first element in the group. (This definition is altered if the parent group is a knockout group; see [11.4.6], "Knockout Groups")
    - The *initial backdrop* is a backdrop that is selected for compositing the group’s first element. This is either the same as the group backdrop (for a non-isolated group) or a fully transparent backdrop (for an isolated group).
    - The *immediate backdrop* is the result of compositing all elements in the group up to but not including the current element.
    
    When all elements in a group have been composited, the result shall be treated as if the group were a single object, which shall then be composited with the group backdrop. This operation shall occur whether the initial backdrop chosen for compositing the elements of the group was the group backdrop or a transparent backdrop. A conforming reader shall ensure that the backdrop’s contribution to the overall result is applied only once.

=== "英文"

    As stated earlier, the elements of a group shall be treated as a separate transparency stack, referred to as the group stack. These objects shall be composited against a selected initial backdrop and the resulting colour, shape, and opacity shall then be treated as if they belonged to a single object. The resulting object is in turn composited with the group’s backdrop in the usual way.
    
    !!! note "NOTE"
    
        This computation entails interpreting the stack as a tree. For an *n-element* group that begins at position i in the stack, it treats the next n objects as an *n-element* substack, whose elements are given an independent numbering of 1 to *n*. These objects are then removed from the object numbering in the parent (containing) stack and replaced by the group object, numbered i, followed by the remaining objects to be painted on top of the group, renumbered starting at *i + 1*. This operation applies recursively to any nested subgroups.
    
    The term *element* (denoted $E_i$ ) refers to a member of some group; it can be either an individual object or a contained subgroup.
    
    From the perspective of a particular element in a nested group, there are three different backdrops of interest:
    
    - The *group backdrop* is the result of compositing all elements up to but not including the first element in the group. (This definition is altered if the parent group is a knockout group; see [11.4.6], "Knockout Groups")
    - The *initial backdrop* is a backdrop that is selected for compositing the group’s first element. This is either the same as the group backdrop (for a non-isolated group) or a fully transparent backdrop (for an isolated group).
    - The *immediate backdrop* is the result of compositing all elements in the group up to but not including the current element.
    
    When all elements in a group have been composited, the result shall be treated as if the group were a single object, which shall then be composited with the group backdrop. This operation shall occur whether the initial backdrop chosen for compositing the elements of the group was the group backdrop or a transparent backdrop. A conforming reader shall ensure that the backdrop’s contribution to the overall result is applied only once.


## 11.4.4 群组合成计算

**Group Compositing Computations**

=== "中文"

    The colour and opacity of a group shall be defined by the *group compositing function*:
    
    $<C,f,\alpha> = \text{Composite}(C_0, \alpha_0, G)$
    
    where the variables have the meanings shown in Table 141.
                       
    <table id="table141" markdown="span">
        <caption>**Table 141 – Arguments and results of the group compositing function**</caption>
        <thead>
            <tr>
                <th>**Variable**</th>
                <th>**Meaning**</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>$G$</td>
                <td>The transparency group: a compound object consisting of all elements $E_1, … , E_n$ of the group—the *n* constituent objects’ colours, shapes, opacities, and blend modes</td>
            </tr>
            <tr>
                <td>$C_0$</td>
                <td>Colour of the group’s backdrop</td>
            </tr>
            <tr>
                <td>$C$</td>
                <td>Computed colour of the group, which shall be used as the source colour when the group is treated as an object</td>
            </tr>
            <tr>
                <td>$f$</td>
                <td>Computed shape of the group, which shall be used as the object shape when the group is treated as an object</td>
            </tr>
            <tr>
                <td>$\alpha_0$</td>
                <td>Alpha of the group’s backdrop</td>
            </tr>
            <tr>
                <td>$\alpha$</td>
                <td>Computed alpha of the group, which shall be used as the object alpha when the group is treated as an object</td>
            </tr>
        </tbody>
    </table>
    
    !!! note "NOTE 1"
    
        The opacity is not given explicitly as an argument or result of this function. Almost all of the computations use the product of shape and opacity (alpha) rather than opacity alone; therefore, it is usually convenient to work directly with shape and alpha rather than shape and opacity. When needed, the opacity can be computed by dividing the alpha by the associated shape.
    
    The result of applying the group compositing function shall then be treated as if it were a single object, which in turn is composited with the group’s backdrop according to the formulas defined in this sub-clause. In those formulas, the colour, shape, and alpha (C, f, and α) calculated by the group compositing function shall be used, respectively, as the source colour $C_s$ , the object shape $f_j$ , and the object alpha $α_j$ .
    
    The group compositing formulas for a non-isolated, non-knockout group are defined as follows:
    
    - Initialization:
    
        $f_{g_0} = \alpha_{g_0} = 0.0$
    
    - For each group element $E_i \in G(i=1, \dots , n)$:
    
        $<C_{s_i}, f_{j_i}, \alpha_{j_i}> = \begin{cases}
         \text{Composite}(C_{i-1}, \alpha _{i-1}, E_i)  & \text{ if } E_i \text{ is a group} \\
         \text{intrinsic color, shape, and }(\text{shape} \times \text{opacity}) \text{ of } E_i & \text{ otherwise }
        \end{cases}$
    
        $\begin{align} 
          & f_{s_i} = f_{j_i} \times f_{m_i} \times f_{k_i} \\
          & \alpha _{s_i} = \alpha _{j_i} \times (f_{m_i} \times q_{m_i}) \times (f_{k_i} \times q_{k_i})\\\\
          & f_{g_i} = \text{Union}(f_{g_{i-1}}, f_{s_i}) \\
          & \alpha _{g_i} = \text{Union}(\alpha _{g_{i-1}}, \alpha _{s_i})\\
          & \alpha _i = \text{Union}(\alpha _0, \alpha _{g_i}) \\\\
          & C_i = \left ( 1 - \frac{\alpha _{s_i}}{\alpha _i} \right ) \times C_{i-1} + \frac{\alpha _{s_i}}{\alpha _i} \times ((1- \alpha _{i-1}) \times C_{s_i} + \alpha _{i-1} \times B_i(C_{i-1}, C_{s_i}))
        \end{align}$
    
    - Result:
    
        $\begin{align} 
          & C = C_n + (C_n - C_0) \times \left( \frac{\alpha _0}{\alpha _{g_n}} - \alpha _0 \right) \\
          & f = f_{g_n} \\
          & \alpha = \alpha _{g_n}
        \end{align}$
    
    where the variables have the meanings shown in Table 142 (in addition to those in Table 141).
    
    For an element $E_i$ that is an elementary object, the colour, shape, and alpha values $C_{s_i}$ , $f_{j_i}$ , and $α_{j_i}$ are intrinsic
    attributes of the object. For an element that is a group, the group compositing function shall be applied
    recursively to the subgroup and the resulting C, f, and α values shall be used for its $C_{s_i}$ , $f_{j_i}$ , and $α_{j_i}$ in the
    calculations for the parent group.
                       
    <table id="table142" markdown="span">
        <caption>**Table 142 – Variables used in the group compositing formulas**</caption>
        <thead>
            <tr>
                <th>**Variable**</th>
                <th>**Meaning**</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>$E_i$</td>
                <td>Element *i* of the group: a compound variable representing the element’s colour, shape, opacity, and blend mode</td>
            </tr>
            <tr>
                <td>$f_{s_i}$</td>
                <td>Source shape for element $E_i$</td>
            </tr>
            <tr>
                <td>$f_{j_i}$</td>
                <td>Object shape for element $E_i$</td>
            </tr>
            <tr>
                <td>$f_{m_i}$</td>
                <td>Mask shape for element $E_i$</td>
            </tr>
            <tr>
                <td>$f_{k_i}$</td>
                <td>Constant shape for element $E_i$</td>
            </tr>
            <tr>
                <td>$f_{g_i}$</td>
                <td>Group shape: the accumulated source shapes of group elements $E_1$ to $E_i$ , excluding the initial backdrop</td>
            </tr>
            <tr>
                <td>$q_{m_i}$</td>
                <td>Mask opacity for element $E_i$</td>
            </tr>
            <tr>
                <td>$q_{k_i}$</td>
                <td>Constant opacity for element $E_i$</td>
            </tr>
            <tr>
                <td>$\alpha_{s_i}$</td>
                <td>Source opacity for element $E_i$</td>
            </tr>
            <tr>
                <td>$\alpha_{j_i}$</td>
                <td>Object alpha for element $E_i$ : the product of its object shape and object opacity</td>
            </tr>
            <tr>
                <td>$\alpha_{g_i}$</td>
                <td>Group alpha: the accumulated source alphas of group elements $E_1$ to $E_i$, excluding the initial backdrop</td>
            </tr>
            <tr>
                <td>$\alpha_i$</td>
                <td>Accumulated alpha after compositing element $E_i$, including the initial backdrop</td>
            </tr>
            <tr>
                <td>$C_{s_i}$</td>
                <td>Source colour for element $E_i$</td>
            </tr>
            <tr>
                <td>$C_i$</td>
                <td>Accumulated colour after compositing element $E_i$, including the initial backdrop</td>
            </tr>
            <tr>
                <td>$B_i(C_{i-1}, C_{s_i})$</td>
                <td>Blend function for element $E_i$</td>
            </tr>
        </tbody>
    </table>
    
    !!! note "NOTE 2"
    
        The elements of a group are composited onto a backdrop that includes the group’s initial backdrop. This is done to achieve the correct effects of the blend modes, most of which are dependent on both the backdrop and source colours being blended. This feature is what distinguishes non-isolated groups from isolated groups, discussed in the next sub-clause.
    
    !!! note "NOTE 3"
    
        Special attention should be directed to the formulas at the end that compute the final results C, f, and α, of the group compositing function. Essentially, these formulas remove the contribution of the group backdrop from the computed results. This ensures that when the group is subsequently composited with that backdrop (possibly with additional shape or opacity inputs or a different blend mode), the backdrop’s contribution is included only once.
     
        For colour, the backdrop removal is accomplished by an explicit calculation, whose effect is essentially the reverse of compositing with the **Normal** blend mode. The formula is a simplification of the following formulas, which present this operation more intuitively:
    
        $\begin{align} 
          & \varphi _b = \frac{(1 - \alpha_{g_n}) \times \alpha _0}{\text{Union}(\alpha _0, \alpha_{g_n}) } \\\\
          & C = \frac{C_n - \varphi_b \times C_0}{1-\varphi _b} 
        \end{align}$
    
        where $φ_b$ is the *backdrop fraction*, the relative contribution of the backdrop colour to the overall colour.
    
    !!! note "NOTE 4"
    
        For shape and alpha, backdrop removal is accomplished by maintaining two sets of variables to hold the accumulated values. There is never any need to compute the corresponding complete shape, $f_i$ , that includes the backdrop contribution.
    
    The group shape and alpha, $f_{g_i}$ and $\alpha _{g_i}$ , shall accumulate only the shape and alpha of the group elements, excluding the group backdrop. Their final values shall become the group results returned by the group compositing function. The complete alpha, αi , includes the backdrop contribution as well; its value is used in the colour compositing computations.
    
    !!! note "NOTE 5"
    
        As a result of these corrections, the effect of compositing objects as a group is the same as that of compositing them separately (without grouping) if the following conditions hold:
    
        The group is non-isolated and has the same knockout attribute as its parent group (see [11.4.5], "Isolated Groups," and “Knockout Groups”).
        
        When compositing the group’s results with the group backdrop, the **Normal** blend mode is used, and the shape and opacity inputs are always 1.0.

=== "英文"

    The colour and opacity of a group shall be defined by the *group compositing function*:
    
    $<C,f,\alpha> = \text{Composite}(C_0, \alpha_0, G)$
    
    where the variables have the meanings shown in Table 141.
                       
    <table id="table141" markdown="span">
        <caption>**Table 141 – Arguments and results of the group compositing function**</caption>
        <thead>
            <tr>
                <th>**Variable**</th>
                <th>**Meaning**</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>$G$</td>
                <td>The transparency group: a compound object consisting of all elements $E_1, … , E_n$ of the group—the *n* constituent objects’ colours, shapes, opacities, and blend modes</td>
            </tr>
            <tr>
                <td>$C_0$</td>
                <td>Colour of the group’s backdrop</td>
            </tr>
            <tr>
                <td>$C$</td>
                <td>Computed colour of the group, which shall be used as the source colour when the group is treated as an object</td>
            </tr>
            <tr>
                <td>$f$</td>
                <td>Computed shape of the group, which shall be used as the object shape when the group is treated as an object</td>
            </tr>
            <tr>
                <td>$\alpha_0$</td>
                <td>Alpha of the group’s backdrop</td>
            </tr>
            <tr>
                <td>$\alpha$</td>
                <td>Computed alpha of the group, which shall be used as the object alpha when the group is treated as an object</td>
            </tr>
        </tbody>
    </table>
    
    !!! note "NOTE 1"
    
        The opacity is not given explicitly as an argument or result of this function. Almost all of the computations use the product of shape and opacity (alpha) rather than opacity alone; therefore, it is usually convenient to work directly with shape and alpha rather than shape and opacity. When needed, the opacity can be computed by dividing the alpha by the associated shape.
    
    The result of applying the group compositing function shall then be treated as if it were a single object, which in turn is composited with the group’s backdrop according to the formulas defined in this sub-clause. In those formulas, the colour, shape, and alpha (C, f, and α) calculated by the group compositing function shall be used, respectively, as the source colour $C_s$ , the object shape $f_j$ , and the object alpha $α_j$ .
    
    The group compositing formulas for a non-isolated, non-knockout group are defined as follows:
    
    - Initialization:
    
        $f_{g_0} = \alpha_{g_0} = 0.0$
    
    - For each group element $E_i \in G(i=1, \dots , n)$:
    
        $<C_{s_i}, f_{j_i}, \alpha_{j_i}> = \begin{cases}
         \text{Composite}(C_{i-1}, \alpha _{i-1}, E_i)  & \text{ if } E_i \text{ is a group} \\
         \text{intrinsic color, shape, and }(\text{shape} \times \text{opacity}) \text{ of } E_i & \text{ otherwise }
        \end{cases}$
    
        $\begin{align} 
          & f_{s_i} = f_{j_i} \times f_{m_i} \times f_{k_i} \\
          & \alpha _{s_i} = \alpha _{j_i} \times (f_{m_i} \times q_{m_i}) \times (f_{k_i} \times q_{k_i})\\\\
          & f_{g_i} = \text{Union}(f_{g_{i-1}}, f_{s_i}) \\
          & \alpha _{g_i} = \text{Union}(\alpha _{g_{i-1}}, \alpha _{s_i})\\
          & \alpha _i = \text{Union}(\alpha _0, \alpha _{g_i}) \\\\
          & C_i = \left ( 1 - \frac{\alpha _{s_i}}{\alpha _i} \right ) \times C_{i-1} + \frac{\alpha _{s_i}}{\alpha _i} \times ((1- \alpha _{i-1}) \times C_{s_i} + \alpha _{i-1} \times B_i(C_{i-1}, C_{s_i}))
        \end{align}$
    
    - Result:
    
        $\begin{align} 
          & C = C_n + (C_n - C_0) \times \left( \frac{\alpha _0}{\alpha _{g_n}} - \alpha _0 \right) \\
          & f = f_{g_n} \\
          & \alpha = \alpha _{g_n}
        \end{align}$
    
    where the variables have the meanings shown in Table 142 (in addition to those in Table 141).
    
    For an element $E_i$ that is an elementary object, the colour, shape, and alpha values $C_{s_i}$ , $f_{j_i}$ , and $α_{j_i}$ are intrinsic
    attributes of the object. For an element that is a group, the group compositing function shall be applied
    recursively to the subgroup and the resulting C, f, and α values shall be used for its $C_{s_i}$ , $f_{j_i}$ , and $α_{j_i}$ in the
    calculations for the parent group.
                       
    <table id="table142" markdown="span">
        <caption>**Table 142 – Variables used in the group compositing formulas**</caption>
        <thead>
            <tr>
                <th>**Variable**</th>
                <th>**Meaning**</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>$E_i$</td>
                <td>Element *i* of the group: a compound variable representing the element’s colour, shape, opacity, and blend mode</td>
            </tr>
            <tr>
                <td>$f_{s_i}$</td>
                <td>Source shape for element $E_i$</td>
            </tr>
            <tr>
                <td>$f_{j_i}$</td>
                <td>Object shape for element $E_i$</td>
            </tr>
            <tr>
                <td>$f_{m_i}$</td>
                <td>Mask shape for element $E_i$</td>
            </tr>
            <tr>
                <td>$f_{k_i}$</td>
                <td>Constant shape for element $E_i$</td>
            </tr>
            <tr>
                <td>$f_{g_i}$</td>
                <td>Group shape: the accumulated source shapes of group elements $E_1$ to $E_i$ , excluding the initial backdrop</td>
            </tr>
            <tr>
                <td>$q_{m_i}$</td>
                <td>Mask opacity for element $E_i$</td>
            </tr>
            <tr>
                <td>$q_{k_i}$</td>
                <td>Constant opacity for element $E_i$</td>
            </tr>
            <tr>
                <td>$\alpha_{s_i}$</td>
                <td>Source opacity for element $E_i$</td>
            </tr>
            <tr>
                <td>$\alpha_{j_i}$</td>
                <td>Object alpha for element $E_i$ : the product of its object shape and object opacity</td>
            </tr>
            <tr>
                <td>$\alpha_{g_i}$</td>
                <td>Group alpha: the accumulated source alphas of group elements $E_1$ to $E_i$, excluding the initial backdrop</td>
            </tr>
            <tr>
                <td>$\alpha_i$</td>
                <td>Accumulated alpha after compositing element $E_i$, including the initial backdrop</td>
            </tr>
            <tr>
                <td>$C_{s_i}$</td>
                <td>Source colour for element $E_i$</td>
            </tr>
            <tr>
                <td>$C_i$</td>
                <td>Accumulated colour after compositing element $E_i$, including the initial backdrop</td>
            </tr>
            <tr>
                <td>$B_i(C_{i-1}, C_{s_i})$</td>
                <td>Blend function for element $E_i$</td>
            </tr>
        </tbody>
    </table>
    
    !!! note "NOTE 2"
    
        The elements of a group are composited onto a backdrop that includes the group’s initial backdrop. This is done to achieve the correct effects of the blend modes, most of which are dependent on both the backdrop and source colours being blended. This feature is what distinguishes non-isolated groups from isolated groups, discussed in the next sub-clause.
    
    !!! note "NOTE 3"
    
        Special attention should be directed to the formulas at the end that compute the final results C, f, and α, of the group compositing function. Essentially, these formulas remove the contribution of the group backdrop from the computed results. This ensures that when the group is subsequently composited with that backdrop (possibly with additional shape or opacity inputs or a different blend mode), the backdrop’s contribution is included only once.
     
        For colour, the backdrop removal is accomplished by an explicit calculation, whose effect is essentially the reverse of compositing with the **Normal** blend mode. The formula is a simplification of the following formulas, which present this operation more intuitively:
    
        $\begin{align} 
          & \varphi _b = \frac{(1 - \alpha_{g_n}) \times \alpha _0}{\text{Union}(\alpha _0, \alpha_{g_n}) } \\\\
          & C = \frac{C_n - \varphi_b \times C_0}{1-\varphi _b} 
        \end{align}$
    
        where $φ_b$ is the *backdrop fraction*, the relative contribution of the backdrop colour to the overall colour.
    
    !!! note "NOTE 4"
    
        For shape and alpha, backdrop removal is accomplished by maintaining two sets of variables to hold the accumulated values. There is never any need to compute the corresponding complete shape, $f_i$ , that includes the backdrop contribution.
    
    The group shape and alpha, $f_{g_i}$ and $\alpha _{g_i}$ , shall accumulate only the shape and alpha of the group elements, excluding the group backdrop. Their final values shall become the group results returned by the group compositing function. The complete alpha, αi , includes the backdrop contribution as well; its value is used in the colour compositing computations.
    
    !!! note "NOTE 5"
    
        As a result of these corrections, the effect of compositing objects as a group is the same as that of compositing them separately (without grouping) if the following conditions hold:
    
        The group is non-isolated and has the same knockout attribute as its parent group (see [11.4.5], "Isolated Groups," and “Knockout Groups”).
        
        When compositing the group’s results with the group backdrop, the **Normal** blend mode is used, and the shape and opacity inputs are always 1.0.

## 11.4.5 孤立团体

**Isolated Groups**

=== "中文"

    An *isolated group* is one whose elements shall be composited onto a fully transparent initial backdrop rather than onto the group’s backdrop. The resulting source colour, object shape, and object alpha for the group shall be therefore independent of the group backdrop. The only interaction with the group backdrop shall occur when the group’s computed colour, shape, and alpha are composited with it.
    
    In particular, the special effects produced by the blend modes of objects within the group take into account only the intrinsic colours and opacities of those objects; they shall not be influenced by the group’s backdrop.
    
    !!! info "EXAMPLE"
    
        Applying the **Multiply** blend mode to an object in the group produces a darkening effect on other objects lower in the group’s stack but not on the group’s backdrop.
    
        Figure L.17 in Annex L illustrates this effect for a group consisting of four overlapping circles in a light gray colour(C = M = Y = 0.0; K = 0.15). The circles are painted within the group with opacity 1.0 in the **Multiply** blend mode; the group itself is painted against its backdrop in **Normal** blend mode. In the top row, the group is isolated and thus does not interact with the rainbow backdrop. In the bottom row, the group is non-isolated and composites with the backdrop. The figure also illustrates the difference between knockout and non-knockout groups (see “[Knockout Groups](#1146-knockout-组)”).
    
    !!! note "NOTE 1"
    
        Conceptually, the effect of an isolated group could be represented by a simple object that directly specifies a colour, shape, and opacity at each point. This *flattening* of an isolated group is sometimes useful for importing and exporting fully composited artwork in applications. Furthermore, a group that specifies an explicit blending colour space shall be an isolated group.
    
    For an isolated group, the group compositing formulas shall be altered by adding one statement to the initialization:
    
    $α_0 = 0.0$  if the group is isolated
    
    That is, the initial backdrop on which the elements of the group are composited shall be transparent rather than inherited from the group’s backdrop.
    
    !!! note "NOTE 2"
    
        This substitution also makes $C_0$ undefined, but the normal compositing formulas take care of that. Also, the result computation for C automatically simplifies to $C = C_n$ , since there is no backdrop contribution to be factored out.

=== "英文"

    An *isolated group* is one whose elements shall be composited onto a fully transparent initial backdrop rather than onto the group’s backdrop. The resulting source colour, object shape, and object alpha for the group shall be therefore independent of the group backdrop. The only interaction with the group backdrop shall occur when the group’s computed colour, shape, and alpha are composited with it.
    
    In particular, the special effects produced by the blend modes of objects within the group take into account only the intrinsic colours and opacities of those objects; they shall not be influenced by the group’s backdrop.
    
    !!! info "EXAMPLE"
    
        Applying the **Multiply** blend mode to an object in the group produces a darkening effect on other objects lower in the group’s stack but not on the group’s backdrop.
    
        Figure L.17 in Annex L illustrates this effect for a group consisting of four overlapping circles in a light gray colour(C = M = Y = 0.0; K = 0.15). The circles are painted within the group with opacity 1.0 in the **Multiply** blend mode; the group itself is painted against its backdrop in **Normal** blend mode. In the top row, the group is isolated and thus does not interact with the rainbow backdrop. In the bottom row, the group is non-isolated and composites with the backdrop. The figure also illustrates the difference between knockout and non-knockout groups (see “[Knockout Groups](#1146-knockout-组)”).
    
    !!! note "NOTE 1"
    
        Conceptually, the effect of an isolated group could be represented by a simple object that directly specifies a colour, shape, and opacity at each point. This *flattening* of an isolated group is sometimes useful for importing and exporting fully composited artwork in applications. Furthermore, a group that specifies an explicit blending colour space shall be an isolated group.
    
    For an isolated group, the group compositing formulas shall be altered by adding one statement to the initialization:
    
    $α_0 = 0.0$  if the group is isolated
    
    That is, the initial backdrop on which the elements of the group are composited shall be transparent rather than inherited from the group’s backdrop.
    
    !!! note "NOTE 2"
    
        This substitution also makes $C_0$ undefined, but the normal compositing formulas take care of that. Also, the result computation for C automatically simplifies to $C = C_n$ , since there is no backdrop contribution to be factored out.


## 11.4.6 Knockout 组

**Knockout Groups**

=== "中文"

    In a knockout group, each individual element shall be composited with the group’s initial backdrop rather than with the stack of preceding elements in the group. When objects have binary shapes (1.0 for inside, 0.0 for outside), each object shall overwrite (knocks out) the effects of any earlier elements it overlaps within the same group. At any given point, only the topmost object enclosing the point shall contribute to the result colour and opacity of the group as a whole.
    
    !!! info "EXAMPLE"
    
        Figure L.17 in [Annex L] about [11.4.5], "Isolated Groups," illustrates the difference between knockout and non-knockout groups. In the left column, the four overlapping circles are defined as a knockout group and therefore do not composite with each other within the group. In the right column, the circles form a non-knockout group and thus do composite with each other. In each column, the upper and lower figures depict an isolated and a non-isolated group, respectively.
    
    !!! note "NOTE 1"
    
        This model is similar to the opaque imaging model, except that the “topmost object wins” rule applies to both the colour and the opacity. Knockout groups are useful in composing a piece of artwork from a collection of overlapping objects, where the topmost object in any overlap completely obscures those beneath. At the same time, the topmost object interacts with the group’s initial backdrop in the usual way, with its opacity and blend mode applied as appropriate.
    
    The concept of knockout is generalized to accommodate fractional shape values. In that case, the immediate backdrop shall be only partially knocked out and shall be replaced by only a fraction of the result of compositing the object with the initial backdrop.
    
    The restated group compositing formulas deal with knockout groups by introducing a new variable, b, which is a subscript that specifies which previous result to use as the backdrop in the compositing computations: 0 in a knockout group or i − 1 in a non-knockout group. When $b = i − 1$, the formulas simplify to the ones given in [11.4.4], "Group Compositing Computations."
    
    In the general case, the computation shall proceed in two stages:
    
    a) Composite the source object with the group’s initial backdrop, disregarding the object’s shape and using a source shape value of 1.0 everywhere. This produces unnormalized temporary alpha and colour results, $α_t$ and $C_t$ .
    
    !!! note "NOTE 2"
    
        For colour, this computation is essentially the same as the unsimplified colour compositing formula given in [11.3.6], "Interpretation of Alpha," but using a source shape of 1.0.
    
    $\begin{align} 
      & \alpha _t = \text{Union}(\alpha_{g_b}, q_{s_i}) \\
      & C_t = (1 - q_{s_i}) \times \alpha _b \times C_b + q_{s_i} \times ((1-\alpha _b) \times C_{s_i} + \alpha _b \times  B_i(C_b, S_{s_i})) 
    \end{align}$
    
    b) Compute a weighted average of this result with the object’s immediate backdrop, using the source shape as the weighting factor. Then normalize the result colour by the result alpha:
    
    $\begin{align} 
      & \alpha _{g_i} = (1 - f_{s_i}) \times \alpha _{g_{i-1}} + {f_{s_i}} \times \alpha_t \\
      & \alpha_i = \text{Union}(\alpha_0, \alpha_{g_i}) \\
      & C_i = \frac{(1 - f_{s_i}) \times \alpha_{i-1} \times C_{i-1} + f_{s_i} \times C_t}{\alpha _i}  
    \end{align}$
    
    This averaging computation shall be performed for both colour and alpha.
    
    !!! note "NOTE 3"
    
        The preceding formulas show this averaging directly. The formulas in [11.4.8], "Summary of Group Compositing Computations," are slightly altered to use source shape and alpha rather than source shape and opacity, avoiding the need to compute a source opacity value explicitly.
    
    !!! note "NOTE 4"
    
        $C_t$ in Group Compositing Computations is slightly different from the preceding $C_t$: it is premultiplied by $f_{s_i}$.
    
    !!! note "NOTE 5"
    
        The extreme values of the source shape produce the straightforward knockout effect. That is, a shape value of 1.0 (inside) yields the colour and opacity that result from compositing the object with the initial backdrop. A shape value of 0.0 (outside) leaves the previous group results unchanged.
    
    The existence of the knockout feature is the main reason for maintaining a separate shape value rather than only a single alpha that combines shape and opacity. The separate shape value shall be computed in any group that is subsequently used as an element of a knockout group.
    
    A knockout group may be isolated or non-isolated; that is, isolated and knockout are independent attributes. A non-isolated knockout group composites its topmost enclosing element with the group’s backdrop. An isolated knockout group composites the element with a transparent backdrop.
    
    !!! note "NOTE 6"
    
        When a non-isolated group is nested within a knockout group, the initial backdrop of the inner group is the same as that of the outer group; it is not the immediate backdrop of the inner group. This behaviour, although perhaps unexpected, is a consequence of the group compositing formulas when b = 0.

=== "英文"

    In a knockout group, each individual element shall be composited with the group’s initial backdrop rather than with the stack of preceding elements in the group. When objects have binary shapes (1.0 for inside, 0.0 for outside), each object shall overwrite (knocks out) the effects of any earlier elements it overlaps within the same group. At any given point, only the topmost object enclosing the point shall contribute to the result colour and opacity of the group as a whole.
    
    !!! info "EXAMPLE"
    
        Figure L.17 in [Annex L] about [11.4.5], "Isolated Groups," illustrates the difference between knockout and non-knockout groups. In the left column, the four overlapping circles are defined as a knockout group and therefore do not composite with each other within the group. In the right column, the circles form a non-knockout group and thus do composite with each other. In each column, the upper and lower figures depict an isolated and a non-isolated group, respectively.
    
    !!! note "NOTE 1"
    
        This model is similar to the opaque imaging model, except that the “topmost object wins” rule applies to both the colour and the opacity. Knockout groups are useful in composing a piece of artwork from a collection of overlapping objects, where the topmost object in any overlap completely obscures those beneath. At the same time, the topmost object interacts with the group’s initial backdrop in the usual way, with its opacity and blend mode applied as appropriate.
    
    The concept of knockout is generalized to accommodate fractional shape values. In that case, the immediate backdrop shall be only partially knocked out and shall be replaced by only a fraction of the result of compositing the object with the initial backdrop.
    
    The restated group compositing formulas deal with knockout groups by introducing a new variable, b, which is a subscript that specifies which previous result to use as the backdrop in the compositing computations: 0 in a knockout group or i − 1 in a non-knockout group. When $b = i − 1$, the formulas simplify to the ones given in [11.4.4], "Group Compositing Computations."
    
    In the general case, the computation shall proceed in two stages:
    
    a) Composite the source object with the group’s initial backdrop, disregarding the object’s shape and using a source shape value of 1.0 everywhere. This produces unnormalized temporary alpha and colour results, $α_t$ and $C_t$ .
    
    !!! note "NOTE 2"
    
        For colour, this computation is essentially the same as the unsimplified colour compositing formula given in [11.3.6], "Interpretation of Alpha," but using a source shape of 1.0.
    
    $\begin{align} 
      & \alpha _t = \text{Union}(\alpha_{g_b}, q_{s_i}) \\
      & C_t = (1 - q_{s_i}) \times \alpha _b \times C_b + q_{s_i} \times ((1-\alpha _b) \times C_{s_i} + \alpha _b \times  B_i(C_b, S_{s_i})) 
    \end{align}$
    
    b) Compute a weighted average of this result with the object’s immediate backdrop, using the source shape as the weighting factor. Then normalize the result colour by the result alpha:
    
    $\begin{align} 
      & \alpha _{g_i} = (1 - f_{s_i}) \times \alpha _{g_{i-1}} + {f_{s_i}} \times \alpha_t \\
      & \alpha_i = \text{Union}(\alpha_0, \alpha_{g_i}) \\
      & C_i = \frac{(1 - f_{s_i}) \times \alpha_{i-1} \times C_{i-1} + f_{s_i} \times C_t}{\alpha _i}  
    \end{align}$
    
    This averaging computation shall be performed for both colour and alpha.
    
    !!! note "NOTE 3"
    
        The preceding formulas show this averaging directly. The formulas in [11.4.8], "Summary of Group Compositing Computations," are slightly altered to use source shape and alpha rather than source shape and opacity, avoiding the need to compute a source opacity value explicitly.
    
    !!! note "NOTE 4"
    
        $C_t$ in Group Compositing Computations is slightly different from the preceding $C_t$: it is premultiplied by $f_{s_i}$.
    
    !!! note "NOTE 5"
    
        The extreme values of the source shape produce the straightforward knockout effect. That is, a shape value of 1.0 (inside) yields the colour and opacity that result from compositing the object with the initial backdrop. A shape value of 0.0 (outside) leaves the previous group results unchanged.
    
    The existence of the knockout feature is the main reason for maintaining a separate shape value rather than only a single alpha that combines shape and opacity. The separate shape value shall be computed in any group that is subsequently used as an element of a knockout group.
    
    A knockout group may be isolated or non-isolated; that is, isolated and knockout are independent attributes. A non-isolated knockout group composites its topmost enclosing element with the group’s backdrop. An isolated knockout group composites the element with a transparent backdrop.
    
    !!! note "NOTE 6"
    
        When a non-isolated group is nested within a knockout group, the initial backdrop of the inner group is the same as that of the outer group; it is not the immediate backdrop of the inner group. This behaviour, although perhaps unexpected, is a consequence of the group compositing formulas when b = 0.

## 11.4.7 Page组

**Page Group**

=== "中文"

    All of the elements painted directly onto a page—both top-level groups and top-level objects that are not part of any group—shall be treated as if they were contained in a transparency group P, which in turn is composited with a context-dependent backdrop. This group is called the *page group*.
    
    The page group shall be treated in one of two distinctly different ways:
    
    - Ordinarily, the page shall be imposed directly on an output medium, such as paper or a display screen. The page group shall be treated as an isolated group, whose results shall then be composited with a backdrop colour appropriate for the medium. The backdrop is nominally white, although varying according to the actual properties of the medium. However, some conforming readers may choose to provide a different backdrop, such as a checker board or grid to aid in visualizing the effects of transparency in the artwork.
    - A “page” of a PDF file may be treated as a graphics object to be used as an element of a page of some other document.
    
    !!! info "EXAMPLE"
    
        This case arises, for example, when placing a PDF file containing a piece of artwork produced by a drawing program into a page layout produced by a layout program. In this situation, the PDF “page” is not composited with the media colour; instead, it is treated as an ordinary transparency group, which can be either isolated or non-isolated and is composited with its backdrop in the normal way.
    
    The remainder of this sub-clause pertains only to the first use of the page group, where it is to be imposed directly on the medium.
    
    The colour C of the page at a given point shall be defined by a simplification of the general group compositing formula:
    
    $\begin{align} 
      \left \langle C_g,f_g,\alpha _g \right \rangle &= \text{Composite}(U, 0, P) \\
      C &= (1 - \alpha _g) \times W + \alpha _g \times C_g
    \end{align}$
    
    where the variables have the meanings shown in Table 143. The first formula computes the colour and alpha for the group given a transparent backdrop—in effect, treating P as an isolated group. The second formula composites the results with the context-dependent backdrop (using the equivalent of the **Normal** blend mode).
                           
    <table id="table143" markdown="span">
        <caption>**Table 143 – Variables used in the page group compositing formulas**</caption>
        <thead>
            <tr>
                <th>**Variable**</th>
                <th>**Meaning**</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>$P$</td>
                <td>The page group, consisting of all elements $E_1, … , E_n$ in the page’s top-level stack</td>
            </tr>
            <tr>
                <td>$C_g$</td>
                <td>Computed colour of the page group</td>
            </tr>
            <tr>
                <td>$f_g$</td>
                <td>Computed shape of the page group</td>
            </tr>
            <tr>
                <td>$\alpha _g$</td>
                <td>Computed alpha of the page group</td>
            </tr>
            <tr>
                <td>$C$</td>
                <td>Computed colour of the page</td>
            </tr>
            <tr>
                <td>$W$</td>
                <td>Initial colour of the page (nominally white but may vary depending on the properties of the medium or the needs of the application)</td>
            </tr>
            <tr>
                <td>$U$</td>
                <td>An undefined colour (which is not used, since the $α_0$ argument of Composite is 0)</td>
            </tr>
        </tbody>
    </table>
    
    If not otherwise specified, the page group’s colour space shall be inherited from the native colour space of the output device—that is, a device colour space, such as **DeviceRGB** or **DeviceCMYK**. An explicit colour space should be specified, particularly a CIE-based space, to ensure more predictable results of the compositing computations within the page group. In this case, all page-level compositing shall be done in the specified colour space, and the entire result shall then be converted to the native colour space of the output device before being composited with the context-dependent backdrop.
    
    !!! note "NOTE"
    
        This case also arises when the page is not actually being rendered but is converted to a flattened representation in an opaque imaging model, such as PostScript.

=== "英文"

    All of the elements painted directly onto a page—both top-level groups and top-level objects that are not part of any group—shall be treated as if they were contained in a transparency group P, which in turn is composited with a context-dependent backdrop. This group is called the *page group*.
    
    The page group shall be treated in one of two distinctly different ways:
    
    - Ordinarily, the page shall be imposed directly on an output medium, such as paper or a display screen. The page group shall be treated as an isolated group, whose results shall then be composited with a backdrop colour appropriate for the medium. The backdrop is nominally white, although varying according to the actual properties of the medium. However, some conforming readers may choose to provide a different backdrop, such as a checker board or grid to aid in visualizing the effects of transparency in the artwork.
    - A “page” of a PDF file may be treated as a graphics object to be used as an element of a page of some other document.
    
    !!! info "EXAMPLE"
    
        This case arises, for example, when placing a PDF file containing a piece of artwork produced by a drawing program into a page layout produced by a layout program. In this situation, the PDF “page” is not composited with the media colour; instead, it is treated as an ordinary transparency group, which can be either isolated or non-isolated and is composited with its backdrop in the normal way.
    
    The remainder of this sub-clause pertains only to the first use of the page group, where it is to be imposed directly on the medium.
    
    The colour C of the page at a given point shall be defined by a simplification of the general group compositing formula:
    
    $\begin{align} 
      \left \langle C_g,f_g,\alpha _g \right \rangle &= \text{Composite}(U, 0, P) \\
      C &= (1 - \alpha _g) \times W + \alpha _g \times C_g
    \end{align}$
    
    where the variables have the meanings shown in Table 143. The first formula computes the colour and alpha for the group given a transparent backdrop—in effect, treating P as an isolated group. The second formula composites the results with the context-dependent backdrop (using the equivalent of the **Normal** blend mode).
                           
    <table id="table143" markdown="span">
        <caption>**Table 143 – Variables used in the page group compositing formulas**</caption>
        <thead>
            <tr>
                <th>**Variable**</th>
                <th>**Meaning**</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>$P$</td>
                <td>The page group, consisting of all elements $E_1, … , E_n$ in the page’s top-level stack</td>
            </tr>
            <tr>
                <td>$C_g$</td>
                <td>Computed colour of the page group</td>
            </tr>
            <tr>
                <td>$f_g$</td>
                <td>Computed shape of the page group</td>
            </tr>
            <tr>
                <td>$\alpha _g$</td>
                <td>Computed alpha of the page group</td>
            </tr>
            <tr>
                <td>$C$</td>
                <td>Computed colour of the page</td>
            </tr>
            <tr>
                <td>$W$</td>
                <td>Initial colour of the page (nominally white but may vary depending on the properties of the medium or the needs of the application)</td>
            </tr>
            <tr>
                <td>$U$</td>
                <td>An undefined colour (which is not used, since the $α_0$ argument of Composite is 0)</td>
            </tr>
        </tbody>
    </table>
    
    If not otherwise specified, the page group’s colour space shall be inherited from the native colour space of the output device—that is, a device colour space, such as **DeviceRGB** or **DeviceCMYK**. An explicit colour space should be specified, particularly a CIE-based space, to ensure more predictable results of the compositing computations within the page group. In this case, all page-level compositing shall be done in the specified colour space, and the entire result shall then be converted to the native colour space of the output device before being composited with the context-dependent backdrop.
    
    !!! note "NOTE"
    
        This case also arises when the page is not actually being rendered but is converted to a flattened representation in an opaque imaging model, such as PostScript.

## 11.4.8 群组合成计算总结

**Summary of Group Compositing Computations**

=== "中文"

    This sub-clause is a restatement of the group compositing formulas that also takes isolated groups and knockout groups into account. See Tables [141](#table141) and [142](#table142) in [11.4.4], "Group Compositing Computations," for the meanings of the variables.
    
    $\left \langle C,f,\alpha \right \rangle = \text{Composite}(C_0, \alpha _0, G)$
    
    Initialization:
    
    $\begin{align} 
      & f_{g_0} = \alpha _{g_0} = 0 \\
      & \alpha _0 = 0 \qquad \qquad \text{if the group is isolated} 
    \end{align}$
    
    For each group element $E_i \in G(i = 1, … , n)$:
    
    $b = \begin{cases}
     0 & \text{ if the group is knockout } \\
     i-1 & \text{ otherwise } 
    \end{cases}$
    
    $\left \langle C_{s_i}, f_{j_i}, \alpha _{j_i} \right \rangle  = \begin{cases}
     \text{Composite}(C_b, \alpha _b, E_i)  & \text{ if } E_i \text{ is a group }  \\
     \text{ intrinsic color, shape, and } (\text{shape} \times \text{opacity} ) \text{ of } E_i   & \text{ otherwise } 
    \end{cases}$
    
    $\begin{align} 
      & f_{s_i} = f_{j_i} \times f_{m_i} \times f_{k_i} \\
      & \alpha _{s_i} = \alpha _{j_i} \times (f_{m_i} \times q_{m_i}) \times (f_{k_i} \times q_{k_i}) \\\\
      & f_{g_i} = \text{Union}(f_{g_{i-1}}, f_{s_i}) \\
      & \alpha _{g_i} = (1 - f_{s_i}) \times \alpha _{g_{i-1}} + (f_{s_i} - \alpha _{s_i}) \times \alpha _{g_b} + \alpha _s \\
      & \alpha _{i} = \text{Union}(\alpha _0, \alpha _{g_i}) \\\\
      & C_t = (f_{s_i} - \alpha _{s_i}) \times \alpha _b \times C_b + \alpha _{s_i} \times ((1 - \alpha _b) \times C_{s_i} + \alpha _b \times B_i(C_b, C_{s_i})) \\\\
      & C_i = \frac{(1 -f_{s_i} \times \alpha _{i-1} \times C_{i-1} + C_t)}{\alpha _i} 
    \end{align}$
    
    Result:
    
    $\begin{align} 
      & C = C_n + (C_n - C_0) \times \left ( \frac{\alpha _0}{\alpha _{g_n}} - \alpha _0  \right ) \\
      & f = f_{g_n} \\
      & \alpha = \alpha _{g_n}
    \end{align}$
    
    !!! note "NOTE"
    
        Once again, keep in mind that these formulas are in their most general form. They can be significantly simplified when some sources of shape and opacity are not present or when shape and opacity need not be maintained separately. Furthermore, in each specific type of group (isolated or not, knockout or not), some terms of these formulas cancel or drop out. An efficient implementation should use the simplified derived formulas.

=== "英文"

    This sub-clause is a restatement of the group compositing formulas that also takes isolated groups and knockout groups into account. See Tables [141](#table141) and [142](#table142) in [11.4.4], "Group Compositing Computations," for the meanings of the variables.
    
    $\left \langle C,f,\alpha \right \rangle = \text{Composite}(C_0, \alpha _0, G)$
    
    Initialization:
    
    $\begin{align} 
      & f_{g_0} = \alpha _{g_0} = 0 \\
      & \alpha _0 = 0 \qquad \qquad \text{if the group is isolated} 
    \end{align}$
    
    For each group element $E_i \in G(i = 1, … , n)$:
    
    $b = \begin{cases}
     0 & \text{ if the group is knockout } \\
     i-1 & \text{ otherwise } 
    \end{cases}$
    
    $\left \langle C_{s_i}, f_{j_i}, \alpha _{j_i} \right \rangle  = \begin{cases}
     \text{Composite}(C_b, \alpha _b, E_i)  & \text{ if } E_i \text{ is a group }  \\
     \text{ intrinsic color, shape, and } (\text{shape} \times \text{opacity} ) \text{ of } E_i   & \text{ otherwise } 
    \end{cases}$
    
    $\begin{align} 
      & f_{s_i} = f_{j_i} \times f_{m_i} \times f_{k_i} \\
      & \alpha _{s_i} = \alpha _{j_i} \times (f_{m_i} \times q_{m_i}) \times (f_{k_i} \times q_{k_i}) \\\\
      & f_{g_i} = \text{Union}(f_{g_{i-1}}, f_{s_i}) \\
      & \alpha _{g_i} = (1 - f_{s_i}) \times \alpha _{g_{i-1}} + (f_{s_i} - \alpha _{s_i}) \times \alpha _{g_b} + \alpha _s \\
      & \alpha _{i} = \text{Union}(\alpha _0, \alpha _{g_i}) \\\\
      & C_t = (f_{s_i} - \alpha _{s_i}) \times \alpha _b \times C_b + \alpha _{s_i} \times ((1 - \alpha _b) \times C_{s_i} + \alpha _b \times B_i(C_b, C_{s_i})) \\\\
      & C_i = \frac{(1 -f_{s_i} \times \alpha _{i-1} \times C_{i-1} + C_t)}{\alpha _i} 
    \end{align}$
    
    Result:
    
    $\begin{align} 
      & C = C_n + (C_n - C_0) \times \left ( \frac{\alpha _0}{\alpha _{g_n}} - \alpha _0  \right ) \\
      & f = f_{g_n} \\
      & \alpha = \alpha _{g_n}
    \end{align}$
    
    !!! note "NOTE"
    
        Once again, keep in mind that these formulas are in their most general form. They can be significantly simplified when some sources of shape and opacity are not present or when shape and opacity need not be maintained separately. Furthermore, in each specific type of group (isolated or not, knockout or not), some terms of these formulas cancel or drop out. An efficient implementation should use the simplified derived formulas.

[11.3.6]: ./s3.md#1136-alpha-的解释
[11.3.8]: ./s3.md#1138-基本合成计算总结
[11.4.4]: #1144-群组合成计算
[11.4.5]: #1145-孤立团体
[11.4.6]: #1146-knockout-组
[11.4.8]: #1148-群组合成计算总结

[Annex L]: ../a12.md